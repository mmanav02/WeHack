import{r as a,j as e,C as I,B as o,l as w,i as t,w as J,m as u,n as j,G as d,O as G,I as $,o as W,L as E,f as M,a1 as Y,X as O,g as U,p as N,q as R,s as q,t as H,h as D}from"./mui-B3kyuV6P.js";import{u as V,a as k}from"./index-B_Yhp6yg.js";import{b as X}from"./router-Dq9hdC_f.js";import{u as K,G as Q,v as Z}from"./mui-icons-Dh0F4x5g.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const re=()=>{const{hackathonId:m}=X(),{user:r}=V(),[z,g]=a.useState(!0),[l,p]=a.useState([]),[y,c]=a.useState(""),[f,x]=a.useState(""),[i,b]=a.useState(null),[L,h]=a.useState(!1),[T,v]=a.useState(!1);a.useEffect(()=>{m&&S()},[m]);const S=async()=>{try{g(!0),c(""),console.log(`🔍 Fetching teams for hackathon ${m}`);const n=(await k.listTeams(parseInt(m))).data||[];console.log(`✅ Found ${n.length} teams:`,n),p(n)}catch(s){console.error("Failed to fetch teams:",s),c("Failed to load teams. Please try again."),p([])}finally{g(!1)}},B=async()=>{if(!(!i||!r))try{v(!0),c(""),console.log("Adding current user",r.id,"to team:",i.id),await k.addTeamMember(i.id,r.id),console.log("✅ Successfully joined team"),h(!1),x(`✅ Successfully joined ${i.name}!`),await S(),setTimeout(()=>x(""),5e3)}catch(s){console.error("Failed to join team:",s),c("Failed to join team. You may already be in a team or an error occurred.")}finally{v(!1)}},F=s=>{b(s),h(!0)},C=()=>{h(!1),b(null)},A=s=>s.members?.some(n=>n.id===r?.id)||!1,P=()=>l.some(s=>A(s));return z?e.jsx(I,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(w,{size:40}),e.jsx(t,{variant:"h6",sx:{ml:2},children:"Loading teams..."})]})}):e.jsxs(I,{maxWidth:"lg",sx:{mt:4,mb:6},children:[e.jsxs(o,{sx:{textAlign:"center",mb:4},children:[e.jsx(K,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(t,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Team Management"}),e.jsx(t,{variant:"h6",color:"textSecondary",children:"View and manage all teams participating in this hackathon"})]}),y&&e.jsx(J,{severity:"error",sx:{mb:3},onClose:()=>c(""),children:y}),f&&e.jsx(J,{severity:"success",sx:{mb:3},onClose:()=>x(""),children:f}),e.jsx(u,{sx:{mb:3},elevation:2,children:e.jsxs(j,{children:[e.jsx(t,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Teams Overview"}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(o,{sx:{textAlign:"center",p:2},children:[e.jsx(t,{variant:"h3",color:"primary.main",sx:{fontWeight:"bold"},children:l.length}),e.jsx(t,{variant:"body1",color:"textSecondary",children:"Total Teams"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(o,{sx:{textAlign:"center",p:2},children:[e.jsx(t,{variant:"h3",color:"success.main",sx:{fontWeight:"bold"},children:l.reduce((s,n)=>s+(n.members?.length||0),0)}),e.jsx(t,{variant:"body1",color:"textSecondary",children:"Total Participants"})]})})]})]})}),l.length===0?e.jsx(u,{elevation:2,children:e.jsxs(j,{sx:{p:4,textAlign:"center"},children:[e.jsx(Q,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(t,{variant:"h6",color:"textSecondary",children:"No teams registered yet"}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"Teams will appear here once participants start registering."})]})}):e.jsx(d,{container:!0,spacing:3,children:l.map(s=>e.jsx(d,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(u,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(j,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:s.name}),r&&!P()&&e.jsx(G,{title:"Join Team",children:e.jsx($,{size:"small",onClick:()=>F(s),sx:{color:"primary.main"},children:e.jsx(Z,{})})}),r&&A(s)&&e.jsx(W,{label:"Your Team",size:"small",color:"success"})]}),e.jsx(o,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(W,{label:`${s.members?.length||0} member${(s.members?.length||0)!==1?"s":""}`,size:"small",color:"primary",variant:"outlined"})}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Team Members:"}),e.jsx(E,{dense:!0,sx:{pt:0},children:(s.members||[]).map(n=>e.jsxs(M,{sx:{px:0,py:.5},children:[e.jsx(Y,{children:e.jsx(O,{sx:{width:24,height:24,fontSize:"0.8rem"},children:n.username.charAt(0).toUpperCase()})}),e.jsx(U,{primary:e.jsxs(t,{variant:"body2",sx:{fontWeight:"medium"},children:[n.username,n.id===r?.id&&" (You)"]}),secondary:e.jsx(t,{variant:"caption",color:"textSecondary",children:n.email})})]},n.id))})]}),s.createdAt&&e.jsx(o,{sx:{p:2,pt:0},children:e.jsxs(t,{variant:"caption",color:"textSecondary",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})})]})},s.id))}),e.jsxs(N,{open:L,onClose:C,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(R,{children:["Join Team",i&&e.jsxs(t,{variant:"body2",color:"textSecondary",children:["Join: ",i.name]})]}),e.jsxs(q,{children:[e.jsxs(t,{variant:"body1",sx:{mb:2},children:['Are you sure you want to join "',i?.name,'"?']}),e.jsxs(t,{variant:"body2",color:"textSecondary",children:["💡 ",e.jsx("strong",{children:"Note:"})," You can only be in one team per hackathon."]})]}),e.jsxs(H,{children:[e.jsx(D,{onClick:C,children:"Cancel"}),e.jsx(D,{onClick:B,variant:"contained",disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:16,sx:{mr:1}}),"Joining..."]}):"Join Team"})]})]})]})};export{re as default};
