import{r as n,j as e,C as A,B as i,l as w,i as t,y as D,m as I,n as k,h as m,G as J,o as G,L as q,f as E,Z as R,_ as N,g as Y,p as O,q as H,s as M,t as U}from"./mui-D_VXG_-A.js";import{u as Z,a as F}from"./index-DyhuwnGA.js";import{b as _,u as K}from"./router-BvxwVjPs.js";import{m as Q,G as V,n as X}from"./mui-icons-C_BHxS9W.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const oe=()=>{const{hackathonId:r}=_(),u=K(),{user:l}=Z(),[L,j]=n.useState(!0),[g,y]=n.useState([]),[b,o]=n.useState(""),[p,f]=n.useState(""),[a,d]=n.useState(null),[W,h]=n.useState(!1),[v,C]=n.useState(!1);n.useEffect(()=>{r&&S()},[r]);const S=async()=>{try{j(!0),o(""),console.log(`🔍 Fetching available teams for hackathon ${r}`);const x=((await F.getAvailableTeams(parseInt(r))).data||[]).filter($=>!$.members?.some(P=>P.id===l?.id));console.log(`✅ Found ${x.length} available teams:`,x),y(x)}catch(s){console.error("Failed to fetch teams:",s),o("Failed to load teams. Please try again."),y([])}finally{j(!1)}},z=async()=>{if(!(!a||!l))try{C(!0),o(""),console.log("Requesting to join team:",a.id,"as user:",l.id),await F.requestToJoinTeam(a.id,l.id),f(`Successfully joined team "${a.name}"!`),h(!1),d(null),await S(),setTimeout(()=>{u(`/hackathons/${r}`)},3e3)}catch(s){console.error("Failed to join team:",s),o("Failed to join team. You may already be in a team or the team may be full.")}finally{C(!1)}},B=s=>{d(s),h(!0)},T=()=>{h(!1),d(null)};return L?e.jsx(A,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(w,{size:40}),e.jsx(t,{variant:"h6",sx:{ml:2},children:"Loading available teams..."})]})}):e.jsxs(A,{maxWidth:"lg",sx:{mt:4,mb:6},children:[e.jsxs(i,{sx:{textAlign:"center",mb:4},children:[e.jsx(Q,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(t,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Browse Teams"}),e.jsx(t,{variant:"h6",color:"textSecondary",children:"Find a team to join for this hackathon"})]}),b&&e.jsx(D,{severity:"error",sx:{mb:3},onClose:()=>o(""),children:b}),p&&e.jsx(D,{severity:"success",sx:{mb:3},onClose:()=>f(""),children:p}),g.length===0?e.jsx(I,{elevation:2,children:e.jsxs(k,{sx:{p:4,textAlign:"center"},children:[e.jsx(V,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(t,{variant:"h6",color:"textSecondary",children:"No teams available to join"}),e.jsx(t,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"All teams may be full, or you may already be in a team."}),e.jsx(m,{variant:"contained",onClick:()=>u(`/hackathons/${r}/register`),children:"Create Your Own Team"})]})}):e.jsx(J,{container:!0,spacing:3,children:g.map(s=>e.jsx(J,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(I,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(k,{sx:{flexGrow:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:s.name}),e.jsx(m,{size:"small",variant:"contained",startIcon:e.jsx(X,{}),onClick:()=>B(s),children:"Join"})]}),e.jsx(i,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(G,{label:`${s.members?.length||0} member${(s.members?.length||0)!==1?"s":""}`,size:"small",color:"primary",variant:"outlined"})}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Current Members:"}),e.jsxs(q,{dense:!0,sx:{pt:0},children:[s.members?.slice(0,3).map(c=>e.jsxs(E,{sx:{px:0,py:.5},children:[e.jsx(R,{children:e.jsx(N,{sx:{width:24,height:24,fontSize:"0.8rem"},children:c.username.charAt(0).toUpperCase()})}),e.jsx(Y,{primary:e.jsx(t,{variant:"body2",sx:{fontWeight:"medium"},children:c.username})})]},c.id)),(s.members?.length||0)>3&&e.jsxs(t,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["+",(s.members?.length||0)-3," more members"]})]})]}),s.createdAt&&e.jsx(i,{sx:{p:2,pt:0},children:e.jsxs(t,{variant:"caption",color:"textSecondary",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})})]})},s.id))}),e.jsxs(O,{open:W,onClose:T,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(H,{children:["Join Team",a&&e.jsxs(t,{variant:"body2",color:"textSecondary",children:["Request to join: ",a.name]})]}),e.jsx(M,{children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{variant:"body1",sx:{mb:2},children:['Are you sure you want to join "',a.name,'"?']}),e.jsxs(t,{variant:"body2",color:"textSecondary",sx:{mb:2},children:["Current team has ",a.members?.length||0," member",(a.members?.length||0)!==1?"s":"","."]}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"Note: You can only be part of one team per hackathon."})]})}),e.jsxs(U,{children:[e.jsx(m,{onClick:T,children:"Cancel"}),e.jsx(m,{onClick:z,variant:"contained",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:16,sx:{mr:1}}),"Joining..."]}):"Join Team"})]})]})]})};export{oe as default};
