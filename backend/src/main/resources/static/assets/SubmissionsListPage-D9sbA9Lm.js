import{r as l,j as t,C as p,B as h,l as C,i as r,w as E,h as m,G as v,m as F,n as B,o as g,a3 as G}from"./mui-6pu-mHHs.js";import{u as H,s as R,h as V,a as q}from"./index-CeQrkf_Y.js";import{u as z}from"./router-Btts6DUI.js";import{r as L,G as T,F as W,h as O,V as M,J as Y}from"./mui-icons-ByUxv65T.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const et=()=>{const u=z(),{user:n}=H(),[f,c]=l.useState([]),[j,k]=l.useState([]),[P,x]=l.useState(!0),[y,w]=l.useState(""),[S,A]=l.useState(!1);l.useEffect(()=>{U()},[n]);const U=async()=>{try{if(x(!0),!n){c([]),x(!1);return}const e=await J(),d=e.some(o=>o.role==="JUDGE"&&o.status==="APPROVED");if(A(d),d){const o=[],i=e.filter(a=>a.role==="JUDGE"&&a.status==="APPROVED").map(a=>a.hackathonId);for(const a of i)try{const s=await R.getPrimarySubmissions(a);s.data&&s.data.length>0&&o.push(...s.data)}catch{console.log(`No primary submissions found for hackathon ${a}`)}if(o.length>0){const a=o.map(s=>({id:s.id,title:s.title||`Submission ${s.id}`,description:s.description||"No description available",teamName:s.team?.name||`Team ${s.teamId}`,hackathonId:s.hackathon?.id||s.hackathonId,hackathonName:s.hackathon?.title||`Hackathon ${s.hackathonId}`,submittedAt:s.submitTime||new Date().toISOString(),projectUrl:s.projectUrl,filePath:s.filePath}));c(a),console.log(`⭐ Found ${a.length} primary submissions for judge ${n.email}`)}else c([])}else try{const o=await R.getByUser(n.id);if(o.data&&o.data.length>0){const i=o.data.map(a=>({id:a.id,title:a.title||`Submission ${a.id}`,description:a.description||"No description available",teamName:a.team?.name||`Team ${a.teamId}`,hackathonId:a.hackathon?.id||a.hackathonId,hackathonName:a.hackathon?.title||`Hackathon ${a.hackathonId}`,submittedAt:a.submitTime||new Date().toISOString(),projectUrl:a.projectUrl,filePath:a.filePath}));c(i),console.log(`📋 Found ${i.length} submissions for user ${n.email}`)}else c([])}catch(o){console.error("Failed to fetch user submissions:",o),c([])}}catch(e){console.error("Failed to fetch data:",e),w("Failed to load submissions. Please try again.")}finally{x(!1)}},J=async()=>{try{if(!n)return[];const d=(await V.getAll()).data,o=[];for(const i of d)try{const I=((await q.getPendingJudgeRequests(i.id)).data||[]).find(b=>b.user?.id===n.id||b.userId===n.id);I&&o.push({hackathonId:i.id,role:"JUDGE",status:I.status})}catch{console.log(`No judge requests found for hackathon ${i.id}`)}return console.log("🔍 User roles found:",o),k(o),o}catch(e){return console.error("Failed to fetch user roles:",e),k([]),[]}},N=e=>!n||!j.length?!1:!!j.find(o=>o.hackathonId===e&&o.role==="JUDGE"&&o.status==="APPROVED"),$=e=>{u(`/submissions/${e}`)},D=e=>{u(`/submissions/${e}/score`)};return P?t.jsx(p,{maxWidth:"lg",sx:{mt:8,mb:4},children:t.jsxs(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[t.jsx(C,{size:40}),t.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading submissions..."})]})}):y?t.jsxs(p,{maxWidth:"lg",sx:{mt:8,mb:4},children:[t.jsx(E,{severity:"error",sx:{mb:3},children:y}),t.jsx(m,{variant:"contained",onClick:()=>u("/hackathons"),children:"Back to Hackathons"})]}):t.jsxs(p,{maxWidth:"lg",sx:{mt:4,mb:6},children:[t.jsxs(h,{sx:{textAlign:"center",mb:4},children:[t.jsx(L,{sx:{fontSize:60,color:"primary.main",mb:2}}),t.jsx(r,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:S?"Primary Submissions to Judge":"My Submissions"}),t.jsx(r,{variant:"h6",color:"textSecondary",children:S?"Review and score the primary submissions from teams":"Browse and manage your hackathon submissions"})]}),f.length===0?t.jsxs(h,{sx:{textAlign:"center",py:8},children:[t.jsx(r,{variant:"h5",gutterBottom:!0,children:"No Submissions Found"}),t.jsx(r,{variant:"body1",color:"textSecondary",sx:{mb:3},children:"No projects have been submitted to hackathons yet. Submissions will appear here once participants submit their projects."}),t.jsx(r,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"To submit a project, participants need to use the submission API endpoint after joining a hackathon."}),t.jsx(m,{variant:"contained",onClick:()=>u("/hackathons"),children:"View Hackathons"})]}):t.jsx(v,{container:!0,spacing:3,children:f.map(e=>t.jsx(v,{item:!0,xs:12,md:6,lg:4,children:t.jsxs(F,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:[t.jsxs(B,{sx:{flexGrow:1},children:[t.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:e.title}),e.teamName&&t.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[t.jsx(T,{sx:{fontSize:16,color:"text.secondary"}}),t.jsx(r,{variant:"body2",color:"textSecondary",children:e.teamName})]}),t.jsx(r,{variant:"body2",color:"textSecondary",sx:{mb:2,lineHeight:1.6},children:e.description.length>120?`${e.description.substring(0,120)}...`:e.description}),e.hackathonName&&t.jsx(g,{label:e.hackathonName,size:"small",color:"primary",variant:"outlined",sx:{mb:2}}),t.jsxs(h,{sx:{display:"flex",gap:1,mb:1,flexWrap:"wrap"},children:[e.filePath&&t.jsx(g,{icon:t.jsx(W,{}),label:"Files Available",size:"small",color:"secondary",variant:"outlined"}),e.projectUrl&&t.jsx(g,{icon:t.jsx(O,{}),label:"Project Link",size:"small",color:"info",variant:"outlined"})]}),e.submittedAt&&t.jsxs(r,{variant:"caption",color:"textSecondary",children:["Submitted: ",new Date(e.submittedAt).toLocaleDateString()]})]}),t.jsxs(G,{sx:{p:2,pt:0},children:[t.jsx(m,{variant:"outlined",startIcon:t.jsx(M,{}),onClick:()=>$(e.id),sx:{mr:1},children:"View Details"}),N(e.hackathonId||0)&&t.jsx(m,{variant:"contained",startIcon:t.jsx(Y,{}),onClick:()=>D(e.id),color:"primary",children:"Judge"})]})]})},e.id))})]})};export{et as default};
