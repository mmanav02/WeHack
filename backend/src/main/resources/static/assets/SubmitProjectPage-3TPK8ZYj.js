import{r as i,j as e,C as y,B as f,l as I,i as n,m as B,n as T,h as p,y as $,w as W,G as u,v as S,F as N,z as O,V as J,W as K,S as Q}from"./mui-B3kyuV6P.js";import{u as X,s as z}from"./index-CTlqFO4F.js";import{c as Z}from"./SubmissionBuilder-Dxlags93.js";import{b as _,u as ee}from"./router-Dq9hdC_f.js";import{f as A,g as te,h as se,F as ie,S as re}from"./mui-icons-Dh0F4x5g.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const me=()=>{const{hackathonId:l}=_(),m=ee(),{user:c}=X(),[h,j]=i.useState(()=>Z().forHackathon(parseInt(l)).byUser(c?.id||0)),[o,k]=i.useState(!1),[P,F]=i.useState(!1),[U,E]=i.useState(!1),[C,r]=i.useState(""),[b,L]=i.useState(""),[g,M]=i.useState(""),[v,H]=i.useState(""),[d,R]=i.useState(null),[a,D]=i.useState([]);i.useEffect(()=>{c?l&&j(t=>t.byUser(c.id)):m("/login",{state:{returnTo:`/hackathons/${l}/submit-project`}})},[c,l,m]),i.useEffect(()=>{j(t=>t.title(b).description(g).projectUrl(v)),d&&j(t=>t.file(d))},[b,g,v,d]);const w=()=>{const t=h.asFinalSubmission().validate();return D(t.errors),t.isValid},G=t=>{const s=t.target.files?.[0];s&&(R(s),D([]))},V=async()=>{if(!c||!l||!h.hasMinimumData()){r("Please add some content before saving draft");return}try{F(!0),r("");const s=h.clone().asDraft().buildDraft();console.log("💾 Saving draft submission..."),await z.saveDraft(s),console.log("✅ Draft saved successfully")}catch(t){console.error("⚠️ Draft save failed:",t),r("Failed to save draft. Please try again.")}finally{F(!1)}},Y=async t=>{if(t.preventDefault(),!c||!l){r("Missing user or hackathon information");return}if(!w()){r("Please fix the errors above");return}k(!0),r("");try{console.log("🚀 Submitting final project...");const s=h.asFinalSubmission(),x=s.build();console.log("📊 Submission completion:",s.getCompletionPercentage()+"%");const q=await z.submitProject(x);console.log("✅ Project submitted successfully:",q.data),E(!0),setTimeout(()=>{m(`/hackathons/${l}`)},3e3)}catch(s){console.error("❌ Project submission failed:",s);const x=typeof s.response?.data=="string"?s.response.data:"";x.includes("60 seconds")?r("⏱️ Please wait 60 seconds before submitting again."):x.includes("File upload failed")?r("File upload failed. Please try with a smaller file."):x.includes("Team not found")?r("You need to join the hackathon first. Please register for the hackathon."):s.response?.status===500?r("Server error occurred. Please check the backend logs and try again."):r(s.response?.data?.message||s.message||"Failed to submit project. Please try again.")}finally{k(!1)}};return c?U?e.jsx(y,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsx(B,{elevation:3,children:e.jsxs(T,{sx:{p:4,textAlign:"center"},children:[e.jsx(A,{sx:{fontSize:60,color:"success.main",mb:2}}),e.jsx(n,{variant:"h4",color:"success.main",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Project Submitted Successfully! 🎉"}),e.jsxs(n,{variant:"h6",sx:{mb:2},children:['Your project "',b,'" has been submitted to the hackathon!']}),e.jsx(n,{variant:"body1",sx:{mb:2},children:"Thank you for participating. Your submission will be evaluated by judges when the judging phase begins."}),e.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Redirecting to hackathon details in 3 seconds..."}),e.jsxs(f,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(p,{variant:"contained",onClick:()=>m(`/hackathons/${l}`),children:"Back to Hackathon"}),e.jsx(p,{variant:"outlined",onClick:()=>m("/submissions"),children:"View All Submissions"})]})]})})}):e.jsxs(y,{maxWidth:"md",sx:{mt:4,mb:6},children:[e.jsxs(f,{sx:{textAlign:"center",mb:4},children:[e.jsx(te,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(n,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Submit Your Project"}),e.jsx(n,{variant:"h6",color:"textSecondary",children:"Share your amazing creation with the hackathon community!"}),e.jsx($,{sx:{maxWidth:200,mx:"auto",mt:2}})]}),C&&e.jsx(W,{severity:"error",sx:{mb:3},children:C}),a.length>0&&e.jsxs(W,{severity:"warning",sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1},children:"Please fix the following issues:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:a.map((t,s)=>e.jsx("li",{children:t},s))})]}),e.jsx(B,{elevation:2,children:e.jsx(T,{sx:{p:4},children:e.jsx(f,{component:"form",onSubmit:Y,noValidate:!0,children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(S,{required:!0,fullWidth:!0,label:"Project Title",value:b,onChange:t=>L(t.target.value),error:a.some(t=>t.includes("Title")),helperText:a.find(t=>t.includes("Title"))||"Give your project a catchy, descriptive name",placeholder:"e.g., AI-Powered Health Assistant",disabled:o})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(S,{required:!0,fullWidth:!0,multiline:!0,rows:6,label:"Project Description",value:g,onChange:t=>M(t.target.value),error:a.some(t=>t.includes("Description")),helperText:a.find(t=>t.includes("Description"))||"Describe what your project does, the problem it solves, and technologies used",placeholder:"Explain your project's purpose, features, technology stack, and impact...",disabled:o})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Project URL (GitHub, Demo, etc.)",value:v,onChange:t=>H(t.target.value),error:a.some(t=>t.includes("URL")),helperText:a.find(t=>t.includes("URL"))||"Optional: Link to your GitHub repo, live demo, or project website",placeholder:"https://github.com/username/project or https://myproject.com",disabled:o,InputProps:{startAdornment:e.jsx(se,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(N,{fullWidth:!0,error:a.some(t=>t.includes("File")),children:[e.jsx(O,{shrink:!0,htmlFor:"file-upload",children:"Project File Upload *"}),e.jsxs(f,{sx:{mt:2},children:[e.jsx(J,{id:"file-upload",type:"file",onChange:G,disabled:o,inputProps:{accept:".zip,.rar,.tar.gz,.pdf,.doc,.docx,.txt,.md"},sx:{display:"none"}}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(p,{variant:"outlined",component:"span",startIcon:e.jsx(ie,{}),disabled:o,sx:{mb:1},children:"Choose File"})}),d&&e.jsxs(n,{variant:"body2",sx:{mt:1,color:"success.main"},children:["✅ Selected: ",d.name," (",(d.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx(K,{children:a.find(t=>t.includes("File"))||"Upload your project files (source code, documentation, etc.) - Max 50MB"})]})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsxs(Q,{direction:"row",spacing:2,justifyContent:"center",sx:{mt:2},children:[e.jsx(p,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:V,disabled:o||P||!h.hasMinimumData(),sx:{px:3},children:P?"Saving...":"Save Draft"}),e.jsx(p,{type:"submit",variant:"contained",size:"large",disabled:o||!w(),startIcon:o?e.jsx(I,{size:20}):e.jsx(A,{}),sx:{px:6,py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderRadius:3,background:"linear-gradient(45deg, #1976d2 30%, #42a5f5 90%)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(25, 118, 210, 0.3)"},"&:disabled":{background:"grey.400",transform:"none",boxShadow:"none"}},children:o?"Submitting...":"Submit Project"})]}),e.jsx(n,{variant:"caption",color:"textSecondary",sx:{display:"block",textAlign:"center",mt:1},children:"Make sure all required fields are filled before submitting"})]})]})})})})]}):e.jsx(y,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsxs(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(I,{size:40}),e.jsx(n,{variant:"h6",sx:{ml:2},children:"Checking authentication..."})]})})};export{me as default};
