var pe=Object.defineProperty;var ge=(t,n,i)=>n in t?pe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i;var J=(t,n,i)=>ge(t,typeof n!="symbol"?n+"":n,i);import{r as l,j as e,P as F,i as c,w as b,v as je,B as o,h as r,X as te,Y,l as M,y as ne,C as W,G as v,o as fe,Z as be,_ as ye,$ as Ce,a0 as ke,S as ve,L as Ie,f as we,a1 as Se,g as Pe,p as De,q as Re,s as Ae,a2 as Te,t as Je,a3 as Ee}from"./mui-B3kyuV6P.js";import{c as N,u as Fe,h as L,a as Q}from"./index-CTlqFO4F.js";import{R as $e,f as ze,i as X,j as He,k as ae,l as ie,m as O,n as U,o as _,p as We,q as ee,D as Le,J as G,G as se,A as Me,r as V,T as Be}from"./mui-icons-Dh0F4x5g.js";import{b as qe,u as Ne}from"./router-Dq9hdC_f.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";class Z{constructor(n){J(this,"id");J(this,"content");J(this,"user");J(this,"hackathon");J(this,"parent");J(this,"replies");J(this,"createdAt");this.id=n.id,this.content=n.content,this.user=n.user,this.hackathon=n.hackathon,this.parent=n.parent,this.replies=n.replies||[],this.createdAt=n.createdAt}getReplies(){return this.replies}addReply(n){n instanceof Z&&(n.parent=this,this.replies.push(n))}hasReplies(){return this.replies.length>0}}const re=({hackathonId:t,userId:n,onSubmit:i,onCancel:s,placeholder:g="Add a comment...",isReply:d=!1})=>{const[m,k]=l.useState(""),[w,S]=l.useState(!1),[j,P]=l.useState(null),h=async R=>{if(R.preventDefault(),!m.trim()){P("Comment cannot be empty");return}if(m.length>1e3){P("Comment must be less than 1000 characters");return}S(!0),P(null);try{await i(m.trim()),k(""),s&&s()}catch(y){P("Failed to post comment. Please try again."),console.error("Error posting comment:",y)}finally{S(!1)}},D=()=>{k(""),P(null),s&&s()};return e.jsxs(F,{elevation:d?0:1,sx:{p:d?1:2,backgroundColor:d?"transparent":"background.paper",border:d?"1px solid #e0e0e0":"none"},children:[!d&&e.jsx(c,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Add Comment"}),j&&e.jsx(b,{severity:"error",sx:{mb:2},children:j}),e.jsxs("form",{onSubmit:h,children:[e.jsx(je,{fullWidth:!0,multiline:!0,rows:d?2:3,placeholder:g,value:m,onChange:R=>k(R.target.value),disabled:w,sx:{mb:2},inputProps:{maxLength:1e3}}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{variant:"caption",color:"text.secondary",children:[m.length,"/1000 characters"]}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[(d||s)&&e.jsx(r,{variant:"outlined",size:"small",startIcon:e.jsx($e,{}),onClick:D,disabled:w,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(r,{type:"submit",variant:"contained",size:"small",startIcon:e.jsx(ze,{}),disabled:w||!m.trim(),sx:{textTransform:"none"},children:w?"Posting...":d?"Reply":"Post Comment"})]})]})]})]})},oe=({comment:t,onReply:n,hackathonId:i,currentUserId:s,depth:g=0})=>{const[d,m]=l.useState(!1),[k,w]=l.useState(!0),S=h=>{n(t.id,h),m(!1)},j=h=>h.split(" ").map(D=>D[0]).join("").toUpperCase(),P=h=>h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Just now";return e.jsx(o,{sx:{mb:2},children:e.jsxs(F,{elevation:g===0?2:1,sx:{p:2,ml:g*3,backgroundColor:g===0?"background.paper":"grey.50",border:g>0?"1px solid #e0e0e0":"none"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(te,{sx:{width:32,height:32,mr:1,bgcolor:"primary.main"},children:t.user.name?j(t.user.name):e.jsx(X,{})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(c,{variant:"subtitle2",sx:{fontWeight:"bold"},children:t.user.name||t.user.email}),e.jsx(c,{variant:"caption",color:"text.secondary",children:P(t.createdAt)})]})]}),e.jsx(c,{variant:"body2",sx:{mb:2,pl:5},children:t.content}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,pl:5},children:[e.jsx(r,{size:"small",startIcon:e.jsx(He,{}),onClick:()=>m(!d),sx:{textTransform:"none"},children:"Reply"}),t.hasReplies()&&e.jsxs(r,{size:"small",startIcon:k?e.jsx(ae,{}):e.jsx(ie,{}),onClick:()=>w(!k),sx:{textTransform:"none"},children:[k?"Hide":"Show"," ",t.getReplies().length,t.getReplies().length===1?" reply":" replies"]})]}),e.jsx(Y,{in:d,children:e.jsx(o,{sx:{mt:2,pl:5},children:e.jsx(re,{hackathonId:i,userId:s,onSubmit:S,onCancel:()=>m(!1),placeholder:`Reply to ${t.user.name||t.user.email}...`,isReply:!0})})}),e.jsx(Y,{in:k,children:e.jsx(o,{sx:{mt:2},children:t.getReplies().map(h=>e.jsx(oe,{comment:h,onReply:n,hackathonId:i,currentUserId:s,depth:g+1},h.id))})})]})})},Oe=({hackathonId:t,currentUserId:n})=>{const[i,s]=l.useState([]),[g,d]=l.useState(!0),[m,k]=l.useState(null),[w,S]=l.useState(!1),[j,P]=l.useState(!0),h=u=>{const f=new Map,I=[];return u.forEach(A=>{const T=new Z(A);f.set(T.id,T)}),u.forEach(A=>{const T=f.get(A.id);if(T)if(A.parent&&A.parent.id){const z=f.get(A.parent.id);z&&z.addReply(T)}else I.push(T)}),I},D=async()=>{try{d(!0),k(null);const u=await N.getComments(t),f=h(u.data);s(f)}catch(u){console.error("Error fetching comments:",u),k("Failed to load comments. Please try again.")}finally{d(!1)}};l.useEffect(()=>{D()},[t]);const R=async u=>{try{const f={hackathonId:t,userId:n,content:u};await N.addComment(f),await D(),S(!1)}catch(f){throw console.error("Error adding comment:",f),new Error("Failed to add comment")}},y=async(u,f)=>{try{const I={hackathonId:t,userId:n,content:f,parentId:u};await N.addComment(I),await D()}catch(I){throw console.error("Error adding reply:",I),new Error("Failed to add reply")}},$=u=>u.reduce((f,I)=>f+1+$(I.getReplies()),0),B=$(i);return g?e.jsxs(F,{elevation:2,sx:{p:3,textAlign:"center"},children:[e.jsx(M,{}),e.jsx(c,{variant:"body2",sx:{mt:2},children:"Loading comments..."})]}):e.jsxs(F,{elevation:2,sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(O,{sx:{mr:1,color:"primary.main"}}),e.jsxs(c,{variant:"h6",sx:{fontWeight:"bold"},children:["Comments (",B,")"]})]}),e.jsx(r,{size:"small",startIcon:j?e.jsx(ae,{}):e.jsx(ie,{}),onClick:()=>P(!j),sx:{textTransform:"none"},children:j?"Collapse":"Expand"})]}),e.jsxs(Y,{in:j,children:[m&&e.jsxs(b,{severity:"error",sx:{mb:2},children:[m,e.jsx(r,{size:"small",onClick:D,sx:{ml:2,textTransform:"none"},children:"Retry"})]}),e.jsx(o,{sx:{mb:3},children:w?e.jsx(re,{hackathonId:t,userId:n,onSubmit:R,onCancel:()=>S(!1),placeholder:"Share your thoughts about this hackathon..."}):e.jsx(r,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(O,{}),onClick:()=>S(!0),sx:{textTransform:"none",py:1.5},children:"Add a comment..."})}),e.jsx(ne,{sx:{mb:3}}),i.length===0?e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(O,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(c,{variant:"body1",color:"text.secondary",children:"No comments yet. Be the first to comment!"})]}):e.jsx(o,{children:i.map(u=>e.jsx(oe,{comment:u,onReply:y,hackathonId:t,currentUserId:n,depth:0},u.id))})]})]})},Ge=ke(Ee)(({theme:t})=>({"&.Mui-active .MuiStepConnector-line":{borderColor:t.palette.primary.main},"&.Mui-completed .MuiStepConnector-line":{borderColor:t.palette.success.main},".MuiStepConnector-line":{borderTopWidth:3,borderRadius:1}})),Ve=t=>{if(!t)return"Date not set";if(/^\d{2}-\d{2}-\d{4}/.test(t)||t.includes(" to "))return t;try{const n=new Date(t);if(isNaN(n.getTime()))return"Invalid date";const i=n.getDate().toString().padStart(2,"0"),s=(n.getMonth()+1).toString().padStart(2,"0"),g=n.getFullYear();return`${i}-${s}-${g}`}catch{return"Date not available"}},ss=()=>{const{hackathonId:t}=qe(),n=Ne(),{user:i}=Fe(),[s,g]=l.useState(null),[d,m]=l.useState([]),[k,w]=l.useState(!0),[S,j]=l.useState(""),[P,h]=l.useState(!1),[D,R]=l.useState(!1),[y,$]=l.useState(!1),[B,u]=l.useState(""),[f,I]=l.useState(!1),A=["Draft","Published","Judging","Completed"],T=[e.jsx(U,{}),e.jsx(_,{}),e.jsx(G,{}),e.jsx(ee,{})];l.useEffect(()=>{t&&(z(),le(),ce())},[t,i]),l.useEffect(()=>{s&&s.participantsCount!==d.length&&g(a=>a?{...a,participantsCount:d.length}:null)},[d.length]);const z=async()=>{try{w(!0);const x=(await L.getAll()).data.find(H=>H.id===parseInt(t));if(!x){j("Hackathon not found");return}let C=0;try{const H=await fetch(`http://localhost:8080/submissions/hackathon/${t}`);H.ok&&(C=(await H.json()).length||0)}catch{console.log("No submissions found")}const me={id:x.id,title:x.title,description:x.description,date:x.date,status:x.status||"Draft",organizerId:x.organizerId,participantsCount:0,judgesCount:0,submissionsCount:C};g(me)}catch(a){console.error("Failed to fetch hackathon:",a),j("Failed to load hackathon details. Please try again.")}finally{w(!1)}},le=async()=>{try{const x=((await Q.getParticipants(parseInt(t))).data||[]).map(C=>({id:C.user?.id||C.userId,username:C.user?.username||`User ${C.userId}`,email:C.user?.email||`user${C.userId}@example.com`,role:"PARTICIPANT",status:C.status}));m(x),console.log(`✅ Found ${x.length} participants`)}catch(a){console.error("Failed to fetch participants:",a),m([])}},ce=async()=>{try{if(!i){I(!1);return}const x=((await Q.getPendingJudgeRequests(parseInt(t))).data||[]).find(C=>(C.user?.id===i.id||C.userId===i.id)&&C.status==="APPROVED");I(!!x),console.log(`🔍 Judge status check: ${x?"APPROVED":"NOT APPROVED"} for user ${i.email}`)}catch(a){console.error("Failed to check judge status:",a),I(!1)}},K=a=>{switch(a){case"Draft":return 0;case"Published":return 1;case"Judging":return 2;case"Completed":return 3;default:return 0}},de=(a,p)=>{const x=K(p);return a<x||a===x&&p==="Completed"},E=()=>i&&s&&s.organizerId&&i.id===s.organizerId,q=async a=>{if(s)try{$(!0),j(""),u("");let p="";switch(a){case"Published":await L.publish(s.id),p="🎉 Hackathon published successfully! It's now visible to all participants.";break;case"Judging":await L.startJudging(s.id),p="⚖️ Judging phase started! Approved judges can now evaluate submissions.";break;case"Completed":await L.complete(s.id),p="🏆 Hackathon completed successfully! Results are now final.";break}g(x=>x?{...x,status:a}:null),u(p),await z(),setTimeout(()=>u(""),5e3)}catch(p){console.error("Failed to transition state:",p),j(`Failed to ${a.toLowerCase()} hackathon. ${p.response?.data?.message||"Please try again."}`)}finally{$(!1)}},he=()=>{E()?n(`/hackathons/${t}/judge-management`):n(`/hackathons/${t}/apply-judge`)},ue=()=>{n(`/hackathons/${t}/register`)},xe=async()=>{if(s)try{R(!0),await L.delete(s.id),h(!1),n("/hackathons",{state:{message:`Hackathon "${s.title}" deleted successfully!`}})}catch(a){console.error("Failed to delete hackathon:",a),j("Failed to delete hackathon. Please try again."),h(!1)}finally{R(!1)}};return k?e.jsx(W,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(M,{size:40}),e.jsx(c,{variant:"h6",sx:{ml:2},children:"Loading hackathon details..."})]})}):S?e.jsxs(W,{maxWidth:"lg",sx:{mt:8,mb:4},children:[e.jsx(b,{severity:"error",sx:{mb:3},children:S}),e.jsx(r,{variant:"contained",onClick:()=>n("/hackathons"),children:"Back to Hackathons"})]}):s?s.status==="Draft"&&!E()?e.jsxs(W,{maxWidth:"lg",sx:{mt:8,mb:4},children:[e.jsx(b,{severity:"info",sx:{mb:3},children:"This hackathon is still in draft mode and not yet published."}),e.jsx(r,{variant:"contained",onClick:()=>n("/hackathons"),children:"Back to Hackathons"})]}):e.jsxs(W,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(v,{container:!0,spacing:4,children:[e.jsxs(v,{item:!0,xs:12,md:8,children:[e.jsxs(F,{elevation:3,sx:{p:4,mb:3},children:[B&&e.jsx(b,{severity:"success",sx:{mb:3},children:B}),e.jsxs(o,{sx:{mb:3},children:[e.jsxs(c,{variant:"h4",component:"h1",gutterBottom:!0,children:["Title: ",s.title]}),e.jsx(fe,{label:s.status,color:s.status==="Published"?"success":s.status==="Draft"?"warning":s.status==="Judging"?"info":"default",size:"small",sx:{mb:2}})]}),e.jsxs(o,{sx:{mb:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Description:"}),e.jsx(c,{variant:"body1",color:"text.secondary",sx:{mb:2},children:s.description}),e.jsxs(c,{variant:"body2",color:"text.secondary",children:[e.jsx(U,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),"Date: ",Ve(s.date)]})]}),e.jsxs(o,{sx:{mb:3},children:[s.status==="Draft"&&e.jsxs(b,{severity:"warning",sx:{mb:2},children:["📝 ",e.jsx("strong",{children:"Draft Mode:"})," This hackathon is not yet visible to participants. Publish it when you're ready to open registration."]}),s.status==="Published"&&e.jsxs(b,{severity:"success",sx:{mb:2},children:["🎉 ",e.jsx("strong",{children:"Published:"})," Your hackathon is live! Participants can now register and teams can submit their projects."]}),s.status==="Judging"&&e.jsxs(b,{severity:"info",sx:{mb:2},children:["⚖️ ",e.jsx("strong",{children:"Judging Phase:"})," Submission period has ended. Approved judges are now evaluating the projects."]}),s.status==="Completed"&&e.jsxs(b,{severity:"info",sx:{mb:2},children:["🏆 ",e.jsx("strong",{children:"Completed:"})," Hackathon has ended. Check out the final leaderboard and winning submissions!"]})]}),e.jsx(ne,{sx:{my:3}}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(c,{variant:"h6",gutterBottom:!0}),e.jsx(be,{activeStep:K(s.status),connector:e.jsx(Ge,{}),sx:{mt:2},children:A.map((a,p)=>e.jsx(ye,{completed:de(p,s.status),children:e.jsx(Ce,{icon:T[p],children:a})},a))})]}),E()&&e.jsxs(o,{sx:{mb:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Organizer Controls:"}),e.jsxs(ve,{direction:"row",spacing:2,sx:{mb:2},children:[s.status==="Draft"&&e.jsx(r,{variant:"contained",startIcon:y?e.jsx(M,{size:16}):e.jsx(_,{}),onClick:()=>q("Published"),disabled:y,children:y?"Publishing...":"Publish"}),s.status==="Published"&&e.jsx(r,{variant:"contained",startIcon:y?e.jsx(M,{size:16}):e.jsx(We,{}),onClick:()=>q("Judging"),disabled:y,children:y?"Starting...":"Start Judging"}),s.status==="Judging"&&e.jsx(r,{variant:"contained",startIcon:y?e.jsx(M,{size:16}):e.jsx(ee,{}),onClick:()=>q("Completed"),disabled:y,children:y?"Completing...":"Complete"}),e.jsx(r,{variant:"outlined",color:"error",startIcon:e.jsx(Le,{}),onClick:()=>h(!0),disabled:y,children:"Delete"})]})]}),e.jsxs(o,{sx:{mb:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Actions"}),e.jsxs(v,{container:!0,spacing:2,children:[(s.status==="Published"||s.status==="Judging")&&e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"contained",color:"primary",startIcon:e.jsx(G,{}),onClick:he,fullWidth:!0,sx:{height:48},children:E()?"Manage Judges":"Judge Req"})}),E()&&(s.status==="Published"||s.status==="Judging"||s.status==="Completed")&&e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"outlined",color:"primary",startIcon:e.jsx(se,{}),onClick:()=>n(`/hackathons/${t}/team-management`),fullWidth:!0,sx:{height:48},children:"Manage Teams"})}),f&&s.status==="Judging"&&e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"contained",color:"secondary",startIcon:e.jsx(G,{}),onClick:()=>n("/submissions"),fullWidth:!0,sx:{height:48},children:"Judge Submissions"})}),!E()&&s.status==="Published"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"contained",color:"success",startIcon:e.jsx(Me,{}),onClick:ue,fullWidth:!0,sx:{height:48},children:"Register Team"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"outlined",color:"primary",startIcon:e.jsx(se,{}),onClick:()=>n(`/hackathons/${t}/browse-teams`),fullWidth:!0,sx:{height:48},children:"Browse Teams"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"outlined",color:"primary",startIcon:e.jsx(V,{}),onClick:()=>n(`/hackathons/${t}/submit-project`),fullWidth:!0,sx:{height:48},children:"Submit Project"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"outlined",color:"secondary",startIcon:e.jsx(V,{}),onClick:()=>n("/submissions"),fullWidth:!0,sx:{height:48},children:"View Submissions"})})]}),(s.status==="Judging"||s.status==="Completed")&&e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(r,{variant:"outlined",startIcon:e.jsx(Be,{}),onClick:()=>n(`/hackathons/${t}/leaderboard`),fullWidth:!0,sx:{height:48},children:"View Leaderboard"})}),s.status==="Draft"&&E()&&e.jsx(v,{item:!0,xs:12,children:e.jsx(b,{severity:"info",sx:{mt:1},children:"🔒 Publish your hackathon to make it visible to participants"})})]})]})]}),i&&s.status!=="Draft"&&e.jsx(Oe,{hackathonId:s.id,currentUserId:i.id})]}),e.jsxs(v,{item:!0,xs:12,md:4,children:[e.jsxs(F,{elevation:3,sx:{p:3,mb:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Statistics"}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{color:"primary"}),e.jsxs(c,{children:["Participants: ",s.participantsCount||0]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{color:"success"}),e.jsxs(c,{children:["Submissions: ",s.submissionsCount||0]})]})]})]}),e.jsxs(F,{elevation:3,sx:{p:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"List of Participants"}),s.status==="Draft"&&e.jsx(b,{severity:"warning",sx:{mb:2},children:"Participants will appear here after you publish the hackathon"}),s.status==="Published"&&e.jsx(b,{severity:"success",sx:{mb:2},children:"Registration is open! Participants can now join"}),s.status==="Judging"&&e.jsx(b,{severity:"info",sx:{mb:2},children:"Hackathon is in judging phase"}),s.status==="Completed"&&e.jsx(b,{severity:"info",sx:{mb:2},children:"Final participant list is now available"}),e.jsx(Ie,{dense:!0,children:d.length>0?d.map(a=>e.jsxs(we,{children:[e.jsx(Se,{children:e.jsx(te,{children:e.jsx(X,{})})}),e.jsx(Pe,{primary:a.username,secondary:a.email})]},a.id)):e.jsx(c,{variant:"body2",color:"text.secondary",sx:{p:2,textAlign:"center"},children:"No participants yet"})})]})]})]}),e.jsxs(De,{open:P,onClose:()=>h(!1),children:[e.jsx(Re,{children:"Delete Hackathon"}),e.jsx(Ae,{children:e.jsxs(Te,{children:['Are you sure you want to delete "',s.title,'"? This action cannot be undone.']})}),e.jsxs(Je,{children:[e.jsx(r,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(r,{onClick:xe,color:"error",disabled:D,children:D?"Deleting...":"Delete"})]})]})]}):e.jsx(W,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsx(b,{severity:"warning",children:"Hackathon not found"})})};export{ss as default};
