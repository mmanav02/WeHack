import{r as m,j as t,C as g,w as v,m as f,n as j,l as S,i as r,B as R,h as A}from"./mui-B3kyuV6P.js";import{u as N,h as G,a as T}from"./index-CTlqFO4F.js";import{b as q,u as O}from"./router-Dq9hdC_f.js";import{q as V,J as k}from"./mui-icons-Dh0F4x5g.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";var y=(s=>(s.PARTICIPANT="PARTICIPANT",s.JUDGE="JUDGE",s.ORGANIZER="ORGANIZER",s))(y||{});class I{static create(e){const{user:a,hackathon:p,role:x,requestedAt:b=new Date}=e;let h,d=!1,o=!1,l=!0;switch(x){case"PARTICIPANT":h="APPROVED",d=!0,o=!1;break;case"JUDGE":h="PENDING",d=!1,o=!0,l=!1;break;case"ORGANIZER":h="APPROVED",d=!0,o=!1;break;default:h="APPROVED",d=!0,o=!1}return p.status==="Completed"&&(l=!1),{user:a,hackathon:p,role:x,status:h,createdAt:b,metadata:{autoApproved:d,requiresReview:o,canEdit:l}}}static createParticipantRequest(e,a){return this.create({user:e,hackathon:a,role:"PARTICIPANT"})}static createJudgeRequest(e,a){return this.create({user:e,hackathon:a,role:"JUDGE"})}static createOrganizerRole(e,a){return this.create({user:e,hackathon:a,role:"ORGANIZER"})}static validateRoleRequest(e){const a=[];return(!e.user||!e.user.id)&&a.push("Valid user is required"),(!e.hackathon||!e.hackathon.id)&&a.push("Valid hackathon is required"),Object.values(y).includes(e.role)||a.push("Valid role is required"),e.hackathon?.status==="Completed"&&e.role!=="ORGANIZER"&&a.push("Cannot join completed hackathon"),e.hackathon?.status==="Draft"&&e.role!=="ORGANIZER"&&a.push("Cannot join unpublished hackathon"),{isValid:a.length===0,errors:a}}static getRoleColor(e){switch(e){case"PARTICIPANT":return"primary";case"JUDGE":return"secondary";case"ORGANIZER":return"success";default:return"info"}}static getStatusColor(e){switch(e){case"APPROVED":return"success";case"PENDING":return"warning";case"REJECTED":return"error";default:return"info"}}static fromApiResponse(e){return this.create({user:{id:e.user?.id||e.userId,username:e.user?.username||e.username||`User ${e.userId}`,email:e.user?.email||e.email||`user${e.userId}@example.com`},hackathon:{id:e.hackathon?.id||e.hackathonId,title:e.hackathon?.title||e.hackathonName||`Hackathon ${e.hackathonId}`,status:e.hackathon?.status||"Published"},role:e.role,requestedAt:e.createdAt?new Date(e.createdAt):new Date})}}const D=()=>{const{hackathonId:s}=q(),e=O(),{user:a}=N(),[p,x]=m.useState(!1),[b,h]=m.useState(!1),[d,o]=m.useState(""),[l,E]=m.useState(null),[n,P]=m.useState(null);m.useEffect(()=>{s&&C()},[s]),m.useEffect(()=>{a&&l&&!n&&w()},[a,l,n]);const C=async()=>{try{const c=(await G.getAll()).data.find(u=>u.id===parseInt(s));if(c){const u={id:c.id,title:c.title,status:c.status};E(u)}}catch(i){console.error("Failed to fetch hackathon details:",i)}},w=()=>{if(!(!a||!l))try{const i={id:a.id,username:a.username||a.email,email:a.email},c=I.createJudgeRequest(i,l);P(c);const u=I.validateRoleRequest({user:i,hackathon:l,role:y.JUDGE});if(!u.isValid){o(`Cannot apply as judge: ${u.errors.join(", ")}`);return}J(c)}catch(i){console.error("Role creation failed:",i),o("Failed to create judge role request")}},J=async i=>{if(!a||!s){o("Missing required information");return}x(!0),o("");try{await T.joinHackathon({userId:a.id,hackathonId:parseInt(s),role:"JUDGE"}),h(!0),console.log("âœ… Judge role request submitted:",{role:i.role,status:i.status,requiresReview:i.metadata?.requiresReview,autoApproved:i.metadata?.autoApproved}),setTimeout(()=>{e(`/hackathons/${s}`)},3e3)}catch(c){console.error("Judge application failed:",c);const u=c.response?.data?.message||c.message||"Application failed. Please try again.";o(u)}finally{x(!1)}};return a?p?t.jsx(g,{maxWidth:"md",sx:{mt:8,mb:4},children:t.jsx(f,{elevation:3,children:t.jsxs(j,{sx:{p:4,textAlign:"center"},children:[t.jsx(S,{size:60,sx:{mb:3}}),t.jsx(r,{variant:"h5",gutterBottom:!0,children:"Submitting Judge Application..."}),t.jsx(r,{variant:"body1",color:"textSecondary",children:"Processing your request using RoleFactory validation"})]})})}):b&&n?t.jsx(g,{maxWidth:"md",sx:{mt:8,mb:4},children:t.jsx(f,{elevation:3,children:t.jsxs(j,{sx:{p:4,textAlign:"center"},children:[t.jsx(V,{sx:{fontSize:80,color:"success.main",mb:3}}),t.jsx(r,{variant:"h4",color:"success.main",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Judge Application Submitted! ðŸŽ‰"}),t.jsxs(r,{variant:"h6",sx:{mb:2},children:['Your application for "',l?.title,'" has been submitted!']}),t.jsxs(R,{sx:{mb:3},children:[t.jsxs(v,{severity:n.metadata?.requiresReview?"info":"success",sx:{mb:2},children:[t.jsxs(r,{variant:"body1",children:[t.jsx("strong",{children:"Status:"})," ",n.status]}),t.jsx(r,{variant:"body2",children:n.metadata?.requiresReview?"Your application is pending review by the hackathon organizer":"Your application has been automatically approved"})]}),t.jsxs(r,{variant:"body2",color:"textSecondary",children:["Role: ",n.role," | Created: ",n.createdAt.toLocaleString()]})]}),t.jsx(r,{variant:"body1",sx:{mb:2},children:n.metadata?.requiresReview?"You will be notified once the organizer reviews your application.":"You can now participate in judging when the judging phase begins."}),t.jsx(r,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Redirecting to hackathon details in 3 seconds..."}),t.jsxs(R,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[t.jsx(A,{variant:"contained",onClick:()=>e(`/hackathons/${s}`),children:"Back to Hackathon"}),t.jsx(A,{variant:"outlined",onClick:()=>e("/dashboard"),children:"View Dashboard"})]})]})})}):d?t.jsx(g,{maxWidth:"md",sx:{mt:8,mb:4},children:t.jsx(f,{elevation:3,children:t.jsxs(j,{sx:{p:4,textAlign:"center"},children:[t.jsx(k,{sx:{fontSize:60,color:"error.main",mb:3}}),t.jsx(r,{variant:"h5",color:"error.main",gutterBottom:!0,children:"Application Failed"}),t.jsx(v,{severity:"error",sx:{mb:3},children:d}),n&&t.jsxs(R,{sx:{mb:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[t.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Role Request Details:"}),t.jsxs(r,{variant:"body2",children:["Role: ",n.role," | Status: ",n.status]}),t.jsxs(r,{variant:"body2",children:["Can Edit: ",n.metadata?.canEdit?"Yes":"No"]})]}),t.jsxs(R,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[t.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),children:"Try Again"}),t.jsx(A,{variant:"outlined",onClick:()=>e(`/hackathons/${s}`),children:"Back to Hackathon"})]})]})})}):t.jsx(g,{maxWidth:"md",sx:{mt:8,mb:4},children:t.jsx(f,{elevation:3,children:t.jsxs(j,{sx:{p:4,textAlign:"center"},children:[t.jsx(k,{sx:{fontSize:60,color:"primary.main",mb:3}}),t.jsx(r,{variant:"h5",gutterBottom:!0,children:"Preparing Judge Application..."}),t.jsx(r,{variant:"body1",color:"textSecondary",children:"Validating application using RoleFactory"})]})})}):t.jsx(g,{maxWidth:"md",sx:{mt:8,mb:4},children:t.jsx(v,{severity:"warning",children:"You must be logged in to apply as a judge."})})};export{D as default};
