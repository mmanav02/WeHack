import{r as h,j as s,C as v,B as m,l as P,i as l,y as d,h as o,G as u,P as w,o as ns,x as is,V as rs,W as os,X as cs,Y as ls,S as ds,L as us,f as hs,Z as xs,_ as ms,g as gs,p as ps,q as js,s as fs,$ as bs,t as ks,a0 as ys}from"./mui-D_VXG_-A.js";import{u as vs,h as C,a as M}from"./index-DyhuwnGA.js";import{b as Cs,u as Ps}from"./router-BvxwVjPs.js";import{d as L,P as E,e as Is,f as O,D as Ds,J,G as q,A as Ss,g as N,T as ws,h as V}from"./mui-icons-C_BHxS9W.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const Js=ls(ys)(({theme:a})=>({"&.Mui-active .MuiStepConnector-line":{borderColor:a.palette.primary.main},"&.Mui-completed .MuiStepConnector-line":{borderColor:a.palette.success.main},".MuiStepConnector-line":{borderTopWidth:3,borderRadius:1}})),Rs=a=>{if(!a)return"Date not set";if(/^\d{2}-\d{2}-\d{4}/.test(a)||a.includes(" to "))return a;try{const i=new Date(a);if(isNaN(i.getTime()))return"Invalid date";const g=i.getDate().toString().padStart(2,"0"),t=(i.getMonth()+1).toString().padStart(2,"0"),j=i.getFullYear();return`${g}-${t}-${j}`}catch{return"Date not available"}},Fs=()=>{const{hackathonId:a}=Cs(),i=Ps(),{user:g}=vs(),[t,j]=h.useState(null),[f,R]=h.useState([]),[G,A]=h.useState(!0),[T,b]=h.useState(""),[Y,k]=h.useState(!1),[$,H]=h.useState(!1),[x,W]=h.useState(!1),[B,I]=h.useState(""),[U,D]=h.useState(!1),X=["Draft","Published","Judging","Completed"],Z=[s.jsx(L,{}),s.jsx(E,{}),s.jsx(J,{}),s.jsx(O,{})];h.useEffect(()=>{a&&(z(),_(),K())},[a,g]),h.useEffect(()=>{t&&t.participantsCount!==f.length&&j(e=>e?{...e,participantsCount:f.length}:null)},[f.length]);const z=async()=>{try{A(!0);const n=(await C.getAll()).data.find(y=>y.id===parseInt(a));if(!n){b("Hackathon not found");return}let c=0;try{const y=await fetch(`http://localhost:8080/submissions/hackathon/${a}`);y.ok&&(c=(await y.json()).length||0)}catch{console.log("No submissions found")}const as={id:n.id,title:n.title,description:n.description,date:n.date,status:n.status||"Draft",organizerId:n.organizerId,participantsCount:0,judgesCount:0,submissionsCount:c};j(as)}catch(e){console.error("Failed to fetch hackathon:",e),b("Failed to load hackathon details. Please try again.")}finally{A(!1)}},_=async()=>{try{const n=((await M.getParticipants(parseInt(a))).data||[]).map(c=>({id:c.user?.id||c.userId,username:c.user?.username||`User ${c.userId}`,email:c.user?.email||`user${c.userId}@example.com`,role:"PARTICIPANT",status:c.status}));R(n),console.log(`âœ… Found ${n.length} participants`)}catch(e){console.error("Failed to fetch participants:",e),R([])}},K=async()=>{try{if(!g){D(!1);return}const n=((await M.getPendingJudgeRequests(parseInt(a))).data||[]).find(c=>(c.user?.id===g.id||c.userId===g.id)&&c.status==="APPROVED");D(!!n),console.log(`ðŸ” Judge status check: ${n?"APPROVED":"NOT APPROVED"} for user ${g.email}`)}catch(e){console.error("Failed to check judge status:",e),D(!1)}},F=e=>{switch(e){case"Draft":return 0;case"Published":return 1;case"Judging":return 2;case"Completed":return 3;default:return 0}},Q=(e,r)=>{const n=F(r);return e<n||e===n&&r==="Completed"},p=()=>g&&t&&t.organizerId&&g.id===t.organizerId,S=async e=>{if(t)try{W(!0),b(""),I("");let r="";switch(e){case"Published":await C.publish(t.id),r="ðŸŽ‰ Hackathon published successfully! It's now visible to all participants.";break;case"Judging":await C.startJudging(t.id),r="âš–ï¸ Judging phase started! Approved judges can now evaluate submissions.";break;case"Completed":await C.complete(t.id),r="ðŸ† Hackathon completed successfully! Results are now final.";break}j(n=>n?{...n,status:e}:null),I(r),await z(),setTimeout(()=>I(""),5e3)}catch(r){console.error("Failed to transition state:",r),b(`Failed to ${e.toLowerCase()} hackathon. ${r.response?.data?.message||"Please try again."}`)}finally{W(!1)}},ss=()=>{p()?i(`/hackathons/${a}/judge-management`):i(`/hackathons/${a}/apply-judge`)},ts=()=>{i(`/hackathons/${a}/register`)},es=async()=>{if(t)try{H(!0),await C.delete(t.id),k(!1),i("/hackathons",{state:{message:`Hackathon "${t.title}" deleted successfully!`}})}catch(e){console.error("Failed to delete hackathon:",e),b("Failed to delete hackathon. Please try again."),k(!1)}finally{H(!1)}};return G?s.jsx(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsxs(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[s.jsx(P,{size:40}),s.jsx(l,{variant:"h6",sx:{ml:2},children:"Loading hackathon details..."})]})}):T?s.jsxs(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(d,{severity:"error",sx:{mb:3},children:T}),s.jsx(o,{variant:"contained",onClick:()=>i("/hackathons"),children:"Back to Hackathons"})]}):t?t.status==="Draft"&&!p()?s.jsxs(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(d,{severity:"info",sx:{mb:3},children:"This hackathon is still in draft mode and not yet published."}),s.jsx(o,{variant:"contained",onClick:()=>i("/hackathons"),children:"Back to Hackathons"})]}):s.jsxs(v,{maxWidth:"lg",sx:{mt:4,mb:4},children:[s.jsxs(u,{container:!0,spacing:4,children:[s.jsx(u,{item:!0,xs:12,md:8,children:s.jsxs(w,{elevation:3,sx:{p:4,mb:3},children:[B&&s.jsx(d,{severity:"success",sx:{mb:3},children:B}),s.jsxs(m,{sx:{mb:3},children:[s.jsxs(l,{variant:"h4",component:"h1",gutterBottom:!0,children:["Title: ",t.title]}),s.jsx(ns,{label:t.status,color:t.status==="Published"?"success":t.status==="Draft"?"warning":t.status==="Judging"?"info":"default",size:"small",sx:{mb:2}})]}),s.jsxs(m,{sx:{mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Description:"}),s.jsx(l,{variant:"body1",color:"text.secondary",sx:{mb:2},children:t.description}),s.jsxs(l,{variant:"body2",color:"text.secondary",children:[s.jsx(L,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),"Date: ",Rs(t.date)]})]}),s.jsxs(m,{sx:{mb:3},children:[t.status==="Draft"&&s.jsxs(d,{severity:"warning",sx:{mb:2},children:["ðŸ“ ",s.jsx("strong",{children:"Draft Mode:"})," This hackathon is not yet visible to participants. Publish it when you're ready to open registration."]}),t.status==="Published"&&s.jsxs(d,{severity:"success",sx:{mb:2},children:["ðŸŽ‰ ",s.jsx("strong",{children:"Published:"})," Your hackathon is live! Participants can now register and teams can submit their projects."]}),t.status==="Judging"&&s.jsxs(d,{severity:"info",sx:{mb:2},children:["âš–ï¸ ",s.jsx("strong",{children:"Judging Phase:"})," Submission period has ended. Approved judges are now evaluating the projects."]}),t.status==="Completed"&&s.jsxs(d,{severity:"info",sx:{mb:2},children:["ðŸ† ",s.jsx("strong",{children:"Completed:"})," Hackathon has ended. Check out the final leaderboard and winning submissions!"]})]}),s.jsx(is,{sx:{my:3}}),s.jsxs(m,{sx:{mb:4},children:[s.jsx(l,{variant:"h6",gutterBottom:!0}),s.jsx(rs,{activeStep:F(t.status),connector:s.jsx(Js,{}),sx:{mt:2},children:X.map((e,r)=>s.jsx(os,{completed:Q(r,t.status),children:s.jsx(cs,{icon:Z[r],children:e})},e))})]}),p()&&s.jsxs(m,{sx:{mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Organizer Controls:"}),s.jsxs(ds,{direction:"row",spacing:2,sx:{mb:2},children:[t.status==="Draft"&&s.jsx(o,{variant:"contained",startIcon:x?s.jsx(P,{size:16}):s.jsx(E,{}),onClick:()=>S("Published"),disabled:x,children:x?"Publishing...":"Publish"}),t.status==="Published"&&s.jsx(o,{variant:"contained",startIcon:x?s.jsx(P,{size:16}):s.jsx(Is,{}),onClick:()=>S("Judging"),disabled:x,children:x?"Starting...":"Start Judging"}),t.status==="Judging"&&s.jsx(o,{variant:"contained",startIcon:x?s.jsx(P,{size:16}):s.jsx(O,{}),onClick:()=>S("Completed"),disabled:x,children:x?"Completing...":"Complete"}),s.jsx(o,{variant:"outlined",color:"error",startIcon:s.jsx(Ds,{}),onClick:()=>k(!0),disabled:x,children:"Delete"})]})]}),s.jsxs(m,{sx:{mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Actions"}),s.jsxs(u,{container:!0,spacing:2,children:[(t.status==="Published"||t.status==="Judging")&&s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"contained",color:"primary",startIcon:s.jsx(J,{}),onClick:ss,fullWidth:!0,sx:{height:48},children:p()?"Manage Judges":"Judge Req"})}),p()&&(t.status==="Published"||t.status==="Judging"||t.status==="Completed")&&s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"outlined",color:"primary",startIcon:s.jsx(q,{}),onClick:()=>i(`/hackathons/${a}/team-management`),fullWidth:!0,sx:{height:48},children:"Manage Teams"})}),U&&t.status==="Judging"&&s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"contained",color:"secondary",startIcon:s.jsx(J,{}),onClick:()=>i("/submissions"),fullWidth:!0,sx:{height:48},children:"Judge Submissions"})}),!p()&&t.status==="Published"&&s.jsxs(s.Fragment,{children:[s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"contained",color:"success",startIcon:s.jsx(Ss,{}),onClick:ts,fullWidth:!0,sx:{height:48},children:"Register Team"})}),s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"outlined",color:"primary",startIcon:s.jsx(q,{}),onClick:()=>i(`/hackathons/${a}/browse-teams`),fullWidth:!0,sx:{height:48},children:"Browse Teams"})}),s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"outlined",color:"primary",startIcon:s.jsx(N,{}),onClick:()=>i(`/hackathons/${a}/submit-project`),fullWidth:!0,sx:{height:48},children:"Submit Project"})})]}),(t.status==="Judging"||t.status==="Completed")&&s.jsx(u,{item:!0,xs:12,sm:6,md:4,children:s.jsx(o,{variant:"outlined",startIcon:s.jsx(ws,{}),onClick:()=>i(`/hackathons/${a}/leaderboard`),fullWidth:!0,sx:{height:48},children:"View Leaderboard"})}),t.status==="Draft"&&p()&&s.jsx(u,{item:!0,xs:12,children:s.jsx(d,{severity:"info",sx:{mt:1},children:"ðŸ”’ Publish your hackathon to make it visible to participants"})})]})]})]})}),s.jsxs(u,{item:!0,xs:12,md:4,children:[s.jsxs(w,{elevation:3,sx:{p:3,mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Statistics"}),s.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[s.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(V,{color:"primary"}),s.jsxs(l,{children:["Participants: ",t.participantsCount||0]})]}),s.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(N,{color:"success"}),s.jsxs(l,{children:["Submissions: ",t.submissionsCount||0]})]})]})]}),s.jsxs(w,{elevation:3,sx:{p:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"List of Participants"}),t.status==="Draft"&&s.jsx(d,{severity:"warning",sx:{mb:2},children:"Participants will appear here after you publish the hackathon"}),t.status==="Published"&&s.jsx(d,{severity:"success",sx:{mb:2},children:"Registration is open! Participants can now join"}),t.status==="Judging"&&s.jsx(d,{severity:"info",sx:{mb:2},children:"Hackathon is in judging phase"}),t.status==="Completed"&&s.jsx(d,{severity:"info",sx:{mb:2},children:"Final participant list is now available"}),s.jsx(us,{dense:!0,children:f.length>0?f.map(e=>s.jsxs(hs,{children:[s.jsx(xs,{children:s.jsx(ms,{children:s.jsx(V,{})})}),s.jsx(gs,{primary:e.username,secondary:e.email})]},e.id)):s.jsx(l,{variant:"body2",color:"text.secondary",sx:{p:2,textAlign:"center"},children:"No participants yet"})})]})]})]}),s.jsxs(ps,{open:Y,onClose:()=>k(!1),children:[s.jsx(js,{children:"Delete Hackathon"}),s.jsx(fs,{children:s.jsxs(bs,{children:['Are you sure you want to delete "',t.title,'"? This action cannot be undone.']})}),s.jsxs(ks,{children:[s.jsx(o,{onClick:()=>k(!1),children:"Cancel"}),s.jsx(o,{onClick:es,color:"error",disabled:$,children:$?"Deleting...":"Delete"})]})]})]}):s.jsx(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsx(d,{severity:"warning",children:"Hackathon not found"})})};export{Fs as default};
