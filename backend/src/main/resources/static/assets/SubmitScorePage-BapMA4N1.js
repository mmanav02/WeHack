import{r as o,j as s,C as I,P as A,i as t,h as k,B as r,l as q,w as R,m as p,n as j,o as C,Q as J,y as X}from"./mui-6pu-mHHs.js";import{u as Z,h as D,a as ss,s as es,j as ts}from"./index-CeQrkf_Y.js";import{b as ns,u as is}from"./router-Btts6DUI.js";import{J as w,I as os,d as as,e as rs,f as cs}from"./mui-icons-ByUxv65T.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const gs=()=>{const{submissionId:v}=ns(),f=is(),{user:c}=Z(),[a,H]=o.useState(null),[T,W]=o.useState(!0),[d,B]=o.useState(!1),[L,N]=o.useState(!1),[E,n]=o.useState(""),[y,z]=o.useState(!1),[u,O]=o.useState(""),[h,U]=o.useState(5),[x,_]=o.useState(5),[g,$]=o.useState(5);o.useEffect(()=>{v&&V()},[v]),o.useEffect(()=>{a&&c&&Q()},[a,c]);const Q=async()=>{if(!(!a||!c))try{const e=(await D.getAll()).data.find(m=>m.id===a.hackathonId);if(e&&(O(e.status),e.status!=="Judging")){n(`Scoring is only available during the Judging phase. Current status: ${e.status}`);return}((await ss.getPendingJudgeRequests(a.hackathonId)).data||[]).find(m=>(m.user?.id===c.id||m.userId===c.id)&&m.status==="APPROVED")?(z(!0),console.log("âœ… User is approved judge for this hackathon")):(z(!1),n("You are not an approved judge for this hackathon. Only approved judges can score submissions."))}catch(i){console.error("Failed to check judge permissions:",i),n("Failed to verify judge permissions. Please try again.")}},V=async()=>{try{W(!0);const e=(await D.getAll()).data;let b=null;for(const S of e)try{const l=((await es.getByHackathon(S.id)).data||[]).find(M=>M.id===parseInt(v));if(l){b={id:l.id,title:l.title,description:l.description,teamName:l.team?.name||`Team ${l.teamId}`,projectUrl:l.projectUrl,hackathonId:S.id};break}}catch{console.log(`No submissions found for hackathon ${S.id}`)}b?(H(b),console.log("ðŸ“‹ Found submission:",b)):n("Submission not found. It may have been deleted or you may not have permission to view it.")}catch(i){console.error("Failed to fetch submission:",i),n("Failed to load submission details. Please try again.")}finally{W(!1)}},G=async i=>{if(i.preventDefault(),!c){n("You must be logged in to submit scores.");return}if(!y){n("Only approved judges can submit scores.");return}if(u!=="Judging"){n("Scoring is only available during the Judging phase.");return}try{B(!0),n("");const e={submissionId:parseInt(v),judgeId:c.id,innovation:h,impact:x,execution:g};console.log("Submitting score data:",e),await ts.submitScore(e),N(!0),setTimeout(()=>{f("/submissions")},2e3)}catch(e){console.error("Failed to submit score:",e),e.response?.status===500&&e.response?.data?.message?.includes("Submission not found")?n("This submission does not exist in the database. Please contact the administrator."):e.response?.status===401||e.response?.status===403?n("You are not authorized to score this submission."):e.response?.status===400?n("Invalid score data. Please check your inputs and try again."):n(e.response?.data?.message||"Failed to submit score. Please try again.")}finally{B(!1)}},P=i=>i>=8?"success":i>=6?"warning":"error",F=h+x+g,K=(F/3).toFixed(1);return c?T?s.jsx(I,{maxWidth:"md",sx:{mt:8,mb:4},children:s.jsxs(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[s.jsx(q,{size:40}),s.jsx(t,{variant:"h6",sx:{ml:2},children:"Loading submission..."})]})}):L?s.jsx(I,{maxWidth:"md",sx:{mt:8,mb:4},children:s.jsxs(A,{elevation:3,sx:{p:4,textAlign:"center"},children:[s.jsx(w,{sx:{fontSize:60,color:"success.main",mb:2}}),s.jsx(t,{variant:"h4",color:"success.main",gutterBottom:!0,children:"Score Submitted Successfully! ðŸŽ‰"}),s.jsx(t,{variant:"h6",sx:{mb:2},children:"Thank you for judging this submission."}),s.jsx(t,{variant:"body1",sx:{mb:2},children:"Your scores have been recorded and will contribute to the final evaluation."}),s.jsx(t,{variant:"body2",color:"textSecondary",children:"Redirecting to submissions page in 2 seconds..."}),s.jsxs(r,{sx:{mt:3},children:[s.jsx(k,{variant:"contained",onClick:()=>f("/submissions"),sx:{mr:2},children:"View Submissions"}),s.jsx(k,{variant:"outlined",onClick:()=>f("/hackathons"),children:"Back to Hackathons"})]})]})}):s.jsxs(I,{maxWidth:"md",sx:{mt:4,mb:6},children:[s.jsxs(r,{sx:{textAlign:"center",mb:4},children:[s.jsx(w,{sx:{fontSize:60,color:"primary.main",mb:2}}),s.jsx(t,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Submit Score"}),s.jsx(t,{variant:"h6",color:"textSecondary",children:"Evaluate this hackathon submission"})]}),E&&s.jsx(R,{severity:"error",sx:{mb:3},children:E}),a&&s.jsx(p,{sx:{mb:3},elevation:2,children:s.jsxs(j,{children:[s.jsx(t,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:a.title}),a.teamName&&s.jsxs(t,{variant:"subtitle1",color:"textSecondary",sx:{mb:2},children:["by ",a.teamName]}),s.jsx(t,{variant:"body1",children:a.description})]})}),s.jsxs(A,{elevation:3,sx:{p:4},children:[s.jsx(t,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",mb:3},children:"Judge Evaluation"}),s.jsxs(r,{component:"form",onSubmit:G,children:[s.jsx(p,{sx:{mb:3},elevation:1,children:s.jsxs(j,{children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[s.jsx(os,{sx:{mr:2,color:"primary.main"}}),s.jsx(t,{variant:"h6",sx:{fontWeight:"bold"},children:"Innovation"}),s.jsx(C,{label:h,color:P(h),sx:{ml:"auto"}})]}),s.jsx(t,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"How creative and original is this solution?"}),s.jsx(J,{value:h,onChange:(i,e)=>U(e),min:1,max:10,step:1,marks:!0,valueLabelDisplay:"auto",disabled:d})]})}),s.jsx(p,{sx:{mb:3},elevation:1,children:s.jsxs(j,{children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[s.jsx(as,{sx:{mr:2,color:"primary.main"}}),s.jsx(t,{variant:"h6",sx:{fontWeight:"bold"},children:"Impact"}),s.jsx(C,{label:x,color:P(x),sx:{ml:"auto"}})]}),s.jsx(t,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"What potential does this solution have to solve real problems?"}),s.jsx(J,{value:x,onChange:(i,e)=>_(e),min:1,max:10,step:1,marks:!0,valueLabelDisplay:"auto",disabled:d})]})}),s.jsx(p,{sx:{mb:3},elevation:1,children:s.jsxs(j,{children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[s.jsx(rs,{sx:{mr:2,color:"primary.main"}}),s.jsx(t,{variant:"h6",sx:{fontWeight:"bold"},children:"Execution"}),s.jsx(C,{label:g,color:P(g),sx:{ml:"auto"}})]}),s.jsx(t,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"How well is this solution implemented and presented?"}),s.jsx(J,{value:g,onChange:(i,e)=>$(e),min:1,max:10,step:1,marks:!0,valueLabelDisplay:"auto",disabled:d})]})}),s.jsx(X,{sx:{my:3}}),s.jsxs(r,{sx:{textAlign:"center",mb:3},children:[s.jsxs(t,{variant:"h6",gutterBottom:!0,children:["Total Score: ",F,"/30"]}),s.jsxs(t,{variant:"h4",color:"primary.main",sx:{fontWeight:"bold"},children:["Average: ",K,"/10"]})]}),u&&u!=="Judging"&&s.jsxs(R,{severity:"warning",sx:{mb:3},children:["Scoring is only available during the Judging phase. Current status: ",u]}),!y&&c&&s.jsx(R,{severity:"error",sx:{mb:3},children:"You must be an approved judge for this hackathon to submit scores."}),y&&u==="Judging"&&s.jsx(R,{severity:"success",sx:{mb:3},children:"âœ… You are authorized to score this submission as an approved judge."}),s.jsx(r,{sx:{textAlign:"center"},children:s.jsx(k,{type:"submit",variant:"contained",size:"large",disabled:d||!y||u!=="Judging",startIcon:d?s.jsx(q,{size:20}):s.jsx(cs,{}),sx:{px:6,py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderRadius:3,background:"linear-gradient(45deg, #1976d2 30%, #42a5f5 90%)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(25, 118, 210, 0.3)"},"&:disabled":{background:"grey.300",transform:"none"}},children:d?"Submitting Score...":"Submit Score"})})]})]}),s.jsx(p,{sx:{mt:3},elevation:1,children:s.jsxs(j,{children:[s.jsx(t,{variant:"h6",gutterBottom:!0,children:"ðŸ“‹ Judging Guidelines"}),s.jsx(t,{variant:"body2",color:"textSecondary",component:"div",children:s.jsxs(r,{component:"ul",sx:{pl:2,m:0},children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Innovation (1-10):"})," Creativity, originality, and uniqueness of the solution"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Impact (1-10):"})," Potential to solve real problems and create value"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Execution (1-10):"})," Quality of implementation, presentation, and completeness"]})]})})]})})]}):s.jsx(I,{maxWidth:"md",sx:{mt:8,mb:4},children:s.jsxs(A,{elevation:3,sx:{p:4,textAlign:"center"},children:[s.jsx(w,{sx:{fontSize:60,color:"primary.main",mb:2}}),s.jsx(t,{variant:"h4",gutterBottom:!0,children:"Authentication Required"}),s.jsx(t,{variant:"body1",color:"textSecondary",children:"You must be logged in as a judge to submit scores."}),s.jsx(k,{variant:"contained",sx:{mt:2},onClick:()=>f("/login"),children:"Sign In"})]})})};export{gs as default};
