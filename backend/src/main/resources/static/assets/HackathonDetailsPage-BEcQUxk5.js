import{r as u,j as s,C as f,B as h,l as y,i as l,y as o,h as c,G as D,P as S,o as ns,x as is,V as rs,W as os,X as cs,Y as ls,S as M,L as ds,f as us,Z as hs,_ as xs,g as ps,p as gs,q as ms,s as js,$ as bs,t as fs,a0 as ks}from"./mui-D_VXG_-A.js";import{u as ys,h as k,a as E}from"./index-BoPtzRr-.js";import{b as vs,u as Cs}from"./router-BvxwVjPs.js";import{d as O,P as W,e as Ps,f as q,D as Is,J as w,A as Ds,g as N,T as Ss,h as V}from"./mui-icons-Bo5rYZLF.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const ws=ls(ks)(({theme:r})=>({"&.Mui-active .MuiStepConnector-line":{borderColor:r.palette.primary.main},"&.Mui-completed .MuiStepConnector-line":{borderColor:r.palette.success.main},".MuiStepConnector-line":{borderTopWidth:3,borderRadius:1}})),Ls=()=>{const{hackathonId:r}=vs(),x=Cs(),{user:p}=ys(),[e,v]=u.useState(null),[J,R]=u.useState([]),[G,A]=u.useState(!0),[H,m]=u.useState(""),[Y,j]=u.useState(!1),[T,$]=u.useState(!1),[d,z]=u.useState(!1),[L,C]=u.useState(""),[U,P]=u.useState(!1),X=["Draft","Published","Judging","Completed"],Z=[s.jsx(O,{}),s.jsx(W,{}),s.jsx(w,{}),s.jsx(q,{})];u.useEffect(()=>{r&&(B(),_(),K())},[r,p]);const B=async()=>{try{A(!0);const a=(await k.getAll()).data.find(b=>b.id===parseInt(r));if(!a){m("Hackathon not found");return}let n=0;try{const b=await fetch(`http://localhost:8080/submissions/hackathon/${r}`);b.ok&&(n=(await b.json()).length||0)}catch{console.log("No submissions found")}const as={id:a.id,title:a.title,description:a.description,date:a.date,status:a.status||"Draft",organizerId:a.organizerId,participantsCount:0,judgesCount:0,submissionsCount:n};v(as)}catch(t){console.error("Failed to fetch hackathon:",t),m("Failed to load hackathon details. Please try again.")}finally{A(!1)}},_=async()=>{try{const a=((await E.getParticipants(parseInt(r))).data||[]).map(n=>({id:n.user?.id||n.userId,username:n.user?.username||`User ${n.userId}`,email:n.user?.email||`user${n.userId}@example.com`,role:"PARTICIPANT",status:n.status}));R(a),console.log(`✅ Found ${a.length} participants`),e&&v(n=>n?{...n,participantsCount:a.length,judgesCount:0}:null)}catch(t){console.error("Failed to fetch participants:",t),R([])}},K=async()=>{try{if(!p){P(!1);return}const a=((await E.getPendingJudgeRequests(parseInt(r))).data||[]).find(n=>(n.user?.id===p.id||n.userId===p.id)&&n.status==="APPROVED");P(!!a),console.log(`🔍 Judge status check: ${a?"APPROVED":"NOT APPROVED"} for user ${p.email}`)}catch(t){console.error("Failed to check judge status:",t),P(!1)}},F=t=>{switch(t){case"Draft":return 0;case"Published":return 1;case"Judging":return 2;case"Completed":return 3;default:return 0}},Q=(t,i)=>{const a=F(i);return t<a||t===a&&i==="Completed"},g=()=>p&&e&&e.organizerId&&p.id===e.organizerId,I=async t=>{if(e)try{z(!0),m(""),C("");let i="";switch(t){case"Published":await k.publish(e.id),i="🎉 Hackathon published successfully! It's now visible to all participants.";break;case"Judging":await k.startJudging(e.id),i="⚖️ Judging phase started! Approved judges can now evaluate submissions.";break;case"Completed":await k.complete(e.id),i="🏆 Hackathon completed successfully! Results are now final.";break}v(a=>a?{...a,status:t}:null),C(i),await B(),setTimeout(()=>C(""),5e3)}catch(i){console.error("Failed to transition state:",i),m(`Failed to ${t.toLowerCase()} hackathon. ${i.response?.data?.message||"Please try again."}`)}finally{z(!1)}},ss=()=>{g()?x(`/hackathons/${r}/judge-management`):x(`/hackathons/${r}/apply-judge`)},es=()=>{x(`/hackathons/${r}/register`)},ts=async()=>{if(e)try{$(!0),await k.delete(e.id),j(!1),x("/hackathons",{state:{message:`Hackathon "${e.title}" deleted successfully!`}})}catch(t){console.error("Failed to delete hackathon:",t),m("Failed to delete hackathon. Please try again."),j(!1)}finally{$(!1)}};return G?s.jsx(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsxs(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[s.jsx(y,{size:40}),s.jsx(l,{variant:"h6",sx:{ml:2},children:"Loading hackathon details..."})]})}):H?s.jsxs(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(o,{severity:"error",sx:{mb:3},children:H}),s.jsx(c,{variant:"contained",onClick:()=>x("/hackathons"),children:"Back to Hackathons"})]}):e?e.status==="Draft"&&!g()?s.jsxs(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(o,{severity:"info",sx:{mb:3},children:"This hackathon is still in draft mode and not yet published."}),s.jsx(c,{variant:"contained",onClick:()=>x("/hackathons"),children:"Back to Hackathons"})]}):s.jsxs(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:[s.jsxs(D,{container:!0,spacing:4,children:[s.jsx(D,{item:!0,xs:12,md:8,children:s.jsxs(S,{elevation:3,sx:{p:4,mb:3},children:[L&&s.jsx(o,{severity:"success",sx:{mb:3},children:L}),s.jsxs(h,{sx:{mb:3},children:[s.jsxs(l,{variant:"h4",component:"h1",gutterBottom:!0,children:["Title: ",e.title]}),s.jsx(ns,{label:e.status,color:e.status==="Published"?"success":e.status==="Draft"?"warning":e.status==="Judging"?"info":"default",size:"small",sx:{mb:2}})]}),s.jsxs(h,{sx:{mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Description:"}),s.jsx(l,{variant:"body1",color:"text.secondary",sx:{mb:2},children:e.description}),s.jsxs(l,{variant:"body2",color:"text.secondary",children:[s.jsx(O,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),"Date: ",new Date(e.date).toLocaleDateString()]})]}),s.jsxs(h,{sx:{mb:3},children:[e.status==="Draft"&&s.jsxs(o,{severity:"warning",sx:{mb:2},children:["📝 ",s.jsx("strong",{children:"Draft Mode:"})," This hackathon is not yet visible to participants. Publish it when you're ready to open registration."]}),e.status==="Published"&&s.jsxs(o,{severity:"success",sx:{mb:2},children:["🎉 ",s.jsx("strong",{children:"Published:"})," Your hackathon is live! Participants can now register and teams can submit their projects."]}),e.status==="Judging"&&s.jsxs(o,{severity:"info",sx:{mb:2},children:["⚖️ ",s.jsx("strong",{children:"Judging Phase:"})," Submission period has ended. Approved judges are now evaluating the projects."]}),e.status==="Completed"&&s.jsxs(o,{severity:"info",sx:{mb:2},children:["🏆 ",s.jsx("strong",{children:"Completed:"})," Hackathon has ended. Check out the final leaderboard and winning submissions!"]})]}),s.jsx(is,{sx:{my:3}}),s.jsxs(h,{sx:{mb:4},children:[s.jsx(l,{variant:"h6",gutterBottom:!0}),s.jsx(rs,{activeStep:F(e.status),connector:s.jsx(ws,{}),sx:{mt:2},children:X.map((t,i)=>s.jsx(os,{completed:Q(i,e.status),children:s.jsx(cs,{icon:Z[i],children:t})},t))})]}),g()&&s.jsxs(h,{sx:{mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Organizer Controls:"}),s.jsxs(M,{direction:"row",spacing:2,sx:{mb:2},children:[e.status==="Draft"&&s.jsx(c,{variant:"contained",startIcon:d?s.jsx(y,{size:16}):s.jsx(W,{}),onClick:()=>I("Published"),disabled:d,children:d?"Publishing...":"Publish"}),e.status==="Published"&&s.jsx(c,{variant:"contained",startIcon:d?s.jsx(y,{size:16}):s.jsx(Ps,{}),onClick:()=>I("Judging"),disabled:d,children:d?"Starting...":"Start Judging"}),e.status==="Judging"&&s.jsx(c,{variant:"contained",startIcon:d?s.jsx(y,{size:16}):s.jsx(q,{}),onClick:()=>I("Completed"),disabled:d,children:d?"Completing...":"Complete"}),s.jsx(c,{variant:"outlined",color:"error",startIcon:s.jsx(Is,{}),onClick:()=>j(!0),disabled:d,children:"Delete"})]})]}),s.jsx(h,{sx:{mb:3},children:s.jsxs(M,{direction:"row",spacing:2,flexWrap:"wrap",children:[(e.status==="Published"||e.status==="Judging")&&s.jsx(c,{variant:"contained",color:"primary",startIcon:s.jsx(w,{}),onClick:ss,children:g()?"Manage Judges":"Judge Req"}),U&&e.status==="Judging"&&s.jsx(c,{variant:"contained",color:"secondary",startIcon:s.jsx(w,{}),onClick:()=>x("/submissions"),children:"Judge Submissions"}),!g()&&e.status==="Published"&&s.jsxs(s.Fragment,{children:[s.jsx(c,{variant:"contained",color:"success",startIcon:s.jsx(Ds,{}),onClick:es,children:"Register Team"}),s.jsx(c,{variant:"outlined",color:"primary",startIcon:s.jsx(N,{}),onClick:()=>x(`/hackathons/${r}/submit-project`),children:"Submit Project"})]}),(e.status==="Judging"||e.status==="Completed")&&s.jsx(c,{variant:"outlined",startIcon:s.jsx(Ss,{}),onClick:()=>x(`/hackathons/${r}/leaderboard`),children:"View Leaderboard"}),e.status==="Draft"&&g()&&s.jsx(o,{severity:"info",sx:{mt:1},children:"🔒 Publish your hackathon to make it visible to participants"})]})})]})}),s.jsxs(D,{item:!0,xs:12,md:4,children:[s.jsxs(S,{elevation:3,sx:{p:3,mb:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"Statistics"}),s.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[s.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(V,{color:"primary"}),s.jsxs(l,{children:["Participants: ",e.participantsCount||0]})]}),s.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(N,{color:"success"}),s.jsxs(l,{children:["Submissions: ",e.submissionsCount||0]})]})]})]}),s.jsxs(S,{elevation:3,sx:{p:3},children:[s.jsx(l,{variant:"h6",gutterBottom:!0,children:"List of Participants"}),e.status==="Draft"&&s.jsx(o,{severity:"warning",sx:{mb:2},children:"Participants will appear here after you publish the hackathon"}),e.status==="Published"&&s.jsx(o,{severity:"success",sx:{mb:2},children:"Registration is open! Participants can now join"}),e.status==="Judging"&&s.jsx(o,{severity:"info",sx:{mb:2},children:"Hackathon is in judging phase"}),e.status==="Completed"&&s.jsx(o,{severity:"info",sx:{mb:2},children:"Final participant list is now available"}),s.jsx(ds,{dense:!0,children:J.length>0?J.map(t=>s.jsxs(us,{children:[s.jsx(hs,{children:s.jsx(xs,{children:s.jsx(V,{})})}),s.jsx(ps,{primary:t.username,secondary:t.email})]},t.id)):s.jsx(l,{variant:"body2",color:"text.secondary",sx:{p:2,textAlign:"center"},children:"No participants yet"})})]})]})]}),s.jsxs(gs,{open:Y,onClose:()=>j(!1),children:[s.jsx(ms,{children:"Delete Hackathon"}),s.jsx(js,{children:s.jsxs(bs,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})}),s.jsxs(fs,{children:[s.jsx(c,{onClick:()=>j(!1),children:"Cancel"}),s.jsx(c,{onClick:ts,color:"error",disabled:T,children:T?"Deleting...":"Delete"})]})]})]}):s.jsx(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsx(o,{severity:"warning",children:"Hackathon not found"})})};export{Ls as default};
