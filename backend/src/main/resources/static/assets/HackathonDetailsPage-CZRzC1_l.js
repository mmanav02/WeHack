import{r as u,j as s,C as f,B as r,l as k,i as o,y as c,h as d,G as I,P as S,o as w,x as ts,Q as as,U as ns,V as is,W as rs,S as F,L as os,f as W,X as cs,Y as ls,g as G,p as ds,q as hs,s as us,Z as xs,t as gs,_ as ms}from"./mui-BflmY4qN.js";import{u as js,h as y,a as ps}from"./index-KeRADMox.js";import{b as bs,u as fs}from"./router-DhxwaH8V.js";import{b as O,P as U,c as ys,d as N,D as ks,J as v,A as vs,T as Cs,e as V,f as Ps}from"./mui-icons-5xIqF4du.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const Ds=rs(ms)(({theme:l})=>({"&.Mui-active .MuiStepConnector-line":{borderColor:l.palette.primary.main},"&.Mui-completed .MuiStepConnector-line":{borderColor:l.palette.success.main},".MuiStepConnector-line":{borderTopWidth:3,borderRadius:1}})),Ts=()=>{const{hackathonId:l}=bs(),x=fs(),{user:J}=js(),[e,C]=u.useState(null),[R,A]=u.useState([]),[q,H]=u.useState(!0),[T,m]=u.useState(""),[Y,j]=u.useState(!1),[z,E]=u.useState(!1),[h,B]=u.useState(!1),[L,P]=u.useState(""),Q=["Draft","Published","Judging","Completed"],X=[s.jsx(O,{}),s.jsx(U,{}),s.jsx(v,{}),s.jsx(N,{})];u.useEffect(()=>{l&&(M(),Z())},[l]);const M=async()=>{try{H(!0);const a=(await y.getAll()).data.find(b=>b.id===parseInt(l));if(!a){m("Hackathon not found");return}let i=0;try{const b=await fetch(`http://localhost:8080/submissions/hackathon/${l}`);b.ok&&(i=(await b.json()).length||0)}catch{console.log("No submissions found")}const p={id:a.id,title:a.title,description:a.description,date:a.date,status:a.status||"Draft",organizerId:a.organizerId,participantsCount:0,judgesCount:0,submissionsCount:i};C(p)}catch(t){console.error("Failed to fetch hackathon:",t),m("Failed to load hackathon details. Please try again.")}finally{H(!1)}},Z=async()=>{try{const a=((await ps.getPendingJudgeRequests(parseInt(l))).data||[]).map(i=>({id:i.user?.id||i.userId,username:i.user?.username||`User ${i.userId}`,email:i.user?.email||`user${i.userId}@example.com`,role:"JUDGE",status:i.status}));A(a),e&&C(i=>i?{...i,judgesCount:a.filter(p=>p.role==="JUDGE").length,participantsCount:a.filter(p=>p.role==="PARTICIPANT").length}:null)}catch(t){console.error("Failed to fetch participants:",t),A([])}},$=t=>{switch(t){case"Draft":return 0;case"Published":return 1;case"Judging":return 2;case"Completed":return 3;default:return 0}},_=(t,n)=>{const a=$(n);return t<a||t===a&&n==="Completed"},g=()=>J&&e&&e.organizerId&&J.id===e.organizerId,D=async t=>{if(e)try{B(!0),m(""),P("");let n="";switch(t){case"Published":await y.publish(e.id),n="ðŸŽ‰ Hackathon published successfully! It's now visible to all participants.";break;case"Judging":await y.startJudging(e.id),n="âš–ï¸ Judging phase started! Approved judges can now evaluate submissions.";break;case"Completed":await y.complete(e.id),n="ðŸ† Hackathon completed successfully! Results are now final.";break}C(a=>a?{...a,status:t}:null),P(n),await M(),setTimeout(()=>P(""),5e3)}catch(n){console.error("Failed to transition state:",n),m(`Failed to ${t.toLowerCase()} hackathon. ${n.response?.data?.message||"Please try again."}`)}finally{B(!1)}},K=()=>{g()?x(`/hackathons/${l}/judge-management`):x(`/hackathons/${l}/apply-judge`)},ss=()=>{x(`/hackathons/${l}/register`)},es=async()=>{if(e)try{E(!0),await y.delete(e.id),j(!1),x("/hackathons",{state:{message:`Hackathon "${e.title}" deleted successfully!`}})}catch(t){console.error("Failed to delete hackathon:",t),m("Failed to delete hackathon. Please try again."),j(!1)}finally{E(!1)}};return q?s.jsx(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsxs(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[s.jsx(k,{size:40}),s.jsx(o,{variant:"h6",sx:{ml:2},children:"Loading hackathon details..."})]})}):T?s.jsxs(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(c,{severity:"error",sx:{mb:3},children:T}),s.jsx(d,{variant:"contained",onClick:()=>x("/hackathons"),children:"Back to Hackathons"})]}):e?e.status==="Draft"&&!g()?s.jsxs(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:[s.jsx(c,{severity:"info",sx:{mb:3},children:"This hackathon is still in draft mode and not yet published."}),s.jsx(d,{variant:"contained",onClick:()=>x("/hackathons"),children:"Back to Hackathons"})]}):s.jsxs(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:[s.jsxs(I,{container:!0,spacing:4,children:[s.jsx(I,{item:!0,xs:12,md:8,children:s.jsxs(S,{elevation:3,sx:{p:4,mb:3},children:[L&&s.jsx(c,{severity:"success",sx:{mb:3},children:L}),s.jsxs(r,{sx:{mb:3},children:[s.jsxs(o,{variant:"h4",component:"h1",gutterBottom:!0,children:["Title: ",e.title]}),s.jsx(w,{label:e.status,color:e.status==="Published"?"success":e.status==="Draft"?"warning":e.status==="Judging"?"info":"default",size:"small",sx:{mb:2}})]}),s.jsxs(r,{sx:{mb:3},children:[s.jsx(o,{variant:"h6",gutterBottom:!0,children:"Description:"}),s.jsx(o,{variant:"body1",color:"text.secondary",sx:{mb:2},children:e.description}),s.jsxs(o,{variant:"body2",color:"text.secondary",children:[s.jsx(O,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),"Date: ",new Date(e.date).toLocaleDateString()]})]}),s.jsxs(r,{sx:{mb:3},children:[e.status==="Draft"&&s.jsxs(c,{severity:"warning",sx:{mb:2},children:["ðŸ“ ",s.jsx("strong",{children:"Draft Mode:"})," This hackathon is not yet visible to participants. Publish it when you're ready to open registration."]}),e.status==="Published"&&s.jsxs(c,{severity:"success",sx:{mb:2},children:["ðŸŽ‰ ",s.jsx("strong",{children:"Published:"})," Your hackathon is live! Participants can now register and teams can submit their projects."]}),e.status==="Judging"&&s.jsxs(c,{severity:"info",sx:{mb:2},children:["âš–ï¸ ",s.jsx("strong",{children:"Judging Phase:"})," Submission period has ended. Approved judges are now evaluating the projects."]}),e.status==="Completed"&&s.jsxs(c,{severity:"info",sx:{mb:2},children:["ðŸ† ",s.jsx("strong",{children:"Completed:"})," Hackathon has ended. Check out the final leaderboard and winning submissions!"]})]}),s.jsx(ts,{sx:{my:3}}),s.jsxs(r,{sx:{mb:4},children:[s.jsx(o,{variant:"h6",gutterBottom:!0}),s.jsx(as,{activeStep:$(e.status),connector:s.jsx(Ds,{}),sx:{mt:2},children:Q.map((t,n)=>s.jsx(ns,{completed:_(n,e.status),children:s.jsx(is,{icon:X[n],children:t})},t))})]}),g()&&s.jsxs(r,{sx:{mb:3},children:[s.jsx(o,{variant:"h6",gutterBottom:!0,children:"Organizer Controls:"}),s.jsxs(F,{direction:"row",spacing:2,sx:{mb:2},children:[e.status==="Draft"&&s.jsx(d,{variant:"contained",startIcon:h?s.jsx(k,{size:16}):s.jsx(U,{}),onClick:()=>D("Published"),disabled:h,children:h?"Publishing...":"Publish"}),e.status==="Published"&&s.jsx(d,{variant:"contained",startIcon:h?s.jsx(k,{size:16}):s.jsx(ys,{}),onClick:()=>D("Judging"),disabled:h,children:h?"Starting...":"Start Judging"}),e.status==="Judging"&&s.jsx(d,{variant:"contained",startIcon:h?s.jsx(k,{size:16}):s.jsx(N,{}),onClick:()=>D("Completed"),disabled:h,children:h?"Completing...":"Complete"}),s.jsx(d,{variant:"outlined",color:"error",startIcon:s.jsx(ks,{}),onClick:()=>j(!0),disabled:h,children:"Delete"})]})]}),s.jsx(r,{sx:{mb:3},children:s.jsxs(F,{direction:"row",spacing:2,children:[(e.status==="Published"||e.status==="Judging")&&s.jsx(d,{variant:"contained",color:"primary",startIcon:s.jsx(v,{}),onClick:K,children:g()?"Manage Judges":"Judge Req"}),!g()&&e.status==="Published"&&s.jsx(d,{variant:"contained",color:"success",startIcon:s.jsx(vs,{}),onClick:ss,children:"Register & Submit"}),(e.status==="Judging"||e.status==="Completed")&&s.jsx(d,{variant:"outlined",startIcon:s.jsx(Cs,{}),onClick:()=>x(`/hackathons/${l}/leaderboard`),children:"View Leaderboard"}),e.status==="Draft"&&g()&&s.jsx(c,{severity:"info",sx:{mt:1},children:"ðŸ”’ Publish your hackathon to make it visible to participants"})]})})]})}),s.jsxs(I,{item:!0,xs:12,md:4,children:[s.jsxs(S,{elevation:3,sx:{p:3,mb:3},children:[s.jsx(o,{variant:"h6",gutterBottom:!0,children:"Statistics"}),s.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(V,{color:"primary"}),s.jsxs(o,{children:["Participants: ",e.participantsCount||0]})]}),s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(v,{color:"secondary"}),s.jsxs(o,{children:["Judges: ",e.judgesCount||0]})]}),s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(Ps,{color:"success"}),s.jsxs(o,{children:["Submissions: ",e.submissionsCount||0]})]})]})]}),s.jsxs(S,{elevation:3,sx:{p:3},children:[s.jsx(o,{variant:"h6",gutterBottom:!0,children:"List of (Participants)"}),e.status==="Draft"&&s.jsx(c,{severity:"warning",sx:{mb:2},children:"Participants will appear here after you publish the hackathon"}),e.status==="Published"&&s.jsx(c,{severity:"success",sx:{mb:2},children:"Registration is open! Participants and judges can now join"}),e.status==="Judging"&&s.jsx(c,{severity:"info",sx:{mb:2},children:"Only approved judges can access submissions for evaluation"}),e.status==="Completed"&&s.jsx(c,{severity:"info",sx:{mb:2},children:"Final participant list and results are now available"}),s.jsxs(os,{dense:!0,children:[R.map(t=>s.jsxs(W,{children:[s.jsx(cs,{children:s.jsx(ls,{children:t.role==="JUDGE"?s.jsx(v,{}):s.jsx(V,{})})}),s.jsx(G,{primary:t.username,secondary:s.jsxs(r,{children:[s.jsx(o,{variant:"body2",color:"text.secondary",children:t.email}),s.jsxs(r,{sx:{display:"flex",gap:1,mt:.5},children:[s.jsx(w,{size:"small",label:t.role,color:t.role==="JUDGE"?"secondary":"primary"}),t.status&&s.jsx(w,{size:"small",label:t.status,color:t.status==="APPROVED"?"success":t.status==="REJECTED"?"error":"warning",variant:"outlined"})]})]})})]},t.id)),R.length===0&&s.jsx(W,{children:s.jsx(G,{primary:"No participants yet",secondary:"Be the first to join this hackathon!"})})]})]})]})]}),s.jsxs(ds,{open:Y,onClose:()=>j(!1),children:[s.jsx(hs,{children:"Delete Hackathon"}),s.jsx(us,{children:s.jsxs(xs,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})}),s.jsxs(gs,{children:[s.jsx(d,{onClick:()=>j(!1),children:"Cancel"}),s.jsx(d,{onClick:es,color:"error",disabled:z,children:z?"Deleting...":"Delete"})]})]})]}):s.jsx(f,{maxWidth:"lg",sx:{mt:8,mb:4},children:s.jsx(c,{severity:"warning",children:"Hackathon not found"})})};export{Ts as default};
