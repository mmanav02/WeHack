import{r,j as e,C,B as n,l as M,i as s,y as I,m as j,n as p,G as c,a3 as L,I as z,o as B,L as U,f as $,Z as G,_ as R,g as H,p as N,q as O,s as q,v as V,t as Z,h as W}from"./mui-D_VXG_-A.js";import{u as _,a as k,b as J}from"./index-DyhuwnGA.js";import{b as K}from"./router-BvxwVjPs.js";import{m as Q,G as X,n as Y}from"./mui-icons-C_BHxS9W.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const oe=()=>{const{hackathonId:h}=K(),{user:ee}=_(),[D,y]=r.useState(!0),[l,b]=r.useState([]),[i,o]=r.useState(""),[f,x]=r.useState(""),[d,v]=r.useState(null),[E,u]=r.useState(!1),[m,g]=r.useState(""),[A,S]=r.useState(!1);r.useEffect(()=>{h&&T()},[h]);const T=async()=>{try{y(!0),o(""),console.log(`🔍 Fetching teams for hackathon ${h}`);const a=(await k.listTeams(parseInt(h))).data||[];console.log(`✅ Found ${a.length} teams:`,a),b(a)}catch(t){console.error("Failed to fetch teams:",t),o("Failed to load teams. Please try again."),b([])}finally{y(!1)}},F=async()=>{if(!(!d||!m.trim()))try{S(!0),o(""),console.log("Looking up user by email:",m);const t=await J.findUserByEmail(m.trim());if(!t.data){o("User not found with that email address. Please check the email and try again.");return}const a=t.data;console.log("Found user:",a),console.log("Adding user",a.id,"to team:",d.id),await k.addTeamMember(d.id,a.id),console.log("✅ Successfully added member to team"),g(""),u(!1),x(`✅ Successfully added ${a.username||a.email} to ${d.name}!`),await T(),setTimeout(()=>x(""),5e3)}catch(t){console.error("Failed to add team member:",t),t.response?.status===404?o("User not found with that email address. Please check the email and try again."):o("Failed to add team member. The user may already be in a team or an error occurred.")}finally{S(!1)}},P=t=>{v(t),u(!0)},w=()=>{u(!1),v(null),g("")};return D?e.jsx(C,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(M,{size:40}),e.jsx(s,{variant:"h6",sx:{ml:2},children:"Loading teams..."})]})}):e.jsxs(C,{maxWidth:"lg",sx:{mt:4,mb:6},children:[e.jsxs(n,{sx:{textAlign:"center",mb:4},children:[e.jsx(Q,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(s,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Team Management"}),e.jsx(s,{variant:"h6",color:"textSecondary",children:"View and manage all teams participating in this hackathon"})]}),i&&e.jsx(I,{severity:"error",sx:{mb:3},onClose:()=>o(""),children:i}),f&&e.jsx(I,{severity:"success",sx:{mb:3},onClose:()=>x(""),children:f}),e.jsx(j,{sx:{mb:3},elevation:2,children:e.jsxs(p,{children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Teams Overview"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"h3",color:"primary.main",sx:{fontWeight:"bold"},children:l.length}),e.jsx(s,{variant:"body1",color:"textSecondary",children:"Total Teams"})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"h3",color:"success.main",sx:{fontWeight:"bold"},children:l.reduce((t,a)=>t+(a.members?.length||0),0)}),e.jsx(s,{variant:"body1",color:"textSecondary",children:"Total Participants"})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"h3",color:"warning.main",sx:{fontWeight:"bold"},children:Math.round(l.reduce((t,a)=>t+(a.members?.length||0),0)/l.length||0)}),e.jsx(s,{variant:"body1",color:"textSecondary",children:"Avg Team Size"})]})})]})]})}),l.length===0?e.jsx(j,{elevation:2,children:e.jsxs(p,{sx:{p:4,textAlign:"center"},children:[e.jsx(X,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(s,{variant:"h6",color:"textSecondary",children:"No teams registered yet"}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Teams will appear here once participants start registering."})]})}):e.jsx(c,{container:!0,spacing:3,children:l.map(t=>e.jsx(c,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(j,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(p,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:t.name}),e.jsx(L,{title:"Add Team Member",children:e.jsx(z,{size:"small",onClick:()=>P(t),sx:{color:"primary.main"},children:e.jsx(Y,{})})})]}),e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(B,{label:`${t.members?.length||0} member${(t.members?.length||0)!==1?"s":""}`,size:"small",color:"primary",variant:"outlined"})}),e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Team Members:"}),e.jsx(U,{dense:!0,sx:{pt:0},children:(t.members||[]).map(a=>e.jsxs($,{sx:{px:0,py:.5},children:[e.jsx(G,{children:e.jsx(R,{sx:{width:24,height:24,fontSize:"0.8rem"},children:a.username.charAt(0).toUpperCase()})}),e.jsx(H,{primary:e.jsx(s,{variant:"body2",sx:{fontWeight:"medium"},children:a.username}),secondary:e.jsx(s,{variant:"caption",color:"textSecondary",children:a.email})})]},a.id))})]}),t.createdAt&&e.jsx(n,{sx:{p:2,pt:0},children:e.jsxs(s,{variant:"caption",color:"textSecondary",children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})})]})},t.id))}),e.jsxs(N,{open:E,onClose:w,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(O,{children:["Add Team Member",d&&e.jsxs(s,{variant:"body2",color:"textSecondary",children:["Adding to: ",d.name]})]}),e.jsxs(q,{children:[e.jsx(V,{autoFocus:!0,margin:"dense",label:"Member Email",type:"email",fullWidth:!0,variant:"outlined",value:m,onChange:t=>g(t.target.value),placeholder:"Enter the email of the user to add",sx:{mt:2},error:!!i&&i.includes("email"),helperText:i&&i.includes("email")?i:""}),e.jsxs(s,{variant:"body2",color:"textSecondary",sx:{mt:2},children:["💡 ",e.jsx("strong",{children:"How it works:"})]}),e.jsx(s,{variant:"body2",color:"textSecondary",component:"div",sx:{mt:1},children:e.jsxs(n,{component:"ul",sx:{pl:2,m:0},children:[e.jsx("li",{children:"Enter the email of a registered user"}),e.jsx("li",{children:"They will be added to the team immediately"}),e.jsx("li",{children:"The user must have an account on the platform"}),e.jsx("li",{children:"Users can only be in one team per hackathon"})]})})]}),e.jsxs(Z,{children:[e.jsx(W,{onClick:w,children:"Cancel"}),e.jsx(W,{onClick:F,variant:"contained",disabled:!m.trim()||A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:16,sx:{mr:1}}),"Adding..."]}):"Add Member"})]})]})]})};export{oe as default};
