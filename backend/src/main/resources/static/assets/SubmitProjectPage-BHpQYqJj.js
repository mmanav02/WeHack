import{r as a,j as e,C as y,B as f,l as D,i as n,m as w,n as B,h as p,y as N,w as I,G as m,v as S,F as O,z as J,V as K,W as Q,S as X}from"./mui-B3kyuV6P.js";import{u as Z,s as T}from"./index-B_Yhp6yg.js";import{c as _}from"./SubmissionBuilder-Dxlags93.js";import{b as ee,u as te}from"./router-Dq9hdC_f.js";import{f as W,g as se,h as ie,F as re,S as ae}from"./mui-icons-Dh0F4x5g.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const he=()=>{const{hackathonId:l}=ee(),h=te(),{user:d}=Z(),[o,k]=a.useState(!1),[P,F]=a.useState(!1),[z,A]=a.useState(!1),[C,i]=a.useState(""),[x,M]=a.useState(""),[b,U]=a.useState(""),[j,L]=a.useState(""),[u,E]=a.useState(null),[r,g]=a.useState([]);a.useEffect(()=>{if(d===null){const t=setTimeout(()=>{h("/login",{state:{returnTo:`/hackathons/${l}/submit-project`}})},100);return()=>clearTimeout(t)}},[d,h,l]);const v=()=>{const t=_();return d?.id&&l&&t.forHackathon(parseInt(l)).byUser(d.id),x&&t.title(x),b&&t.description(b),j&&t.projectUrl(j),u&&t.file(u),t},H=()=>{try{const s=v().asFinalSubmission().validate();return g(s.errors),s.isValid}catch(t){return console.error("Validation error:",t),g(["Validation failed. Please check your inputs."]),!1}},V=t=>{const s=t.target.files?.[0];s&&(E(s),g([]))},R=async()=>{if(!d||!l){i("Missing user or hackathon information");return}const t=v();if(!t.hasMinimumData()){i("Please add some content before saving draft");return}try{F(!0),i("");const c=t.clone().asDraft().buildDraft();console.log("💾 Saving draft submission..."),await T.saveDraft(c),console.log("✅ Draft saved successfully")}catch(s){console.error("⚠️ Draft save failed:",s),i("Failed to save draft. Please try again.")}finally{F(!1)}},G=async t=>{if(t.preventDefault(),!d||!l){i("Missing user or hackathon information");return}if(!H()){i("Please fix the errors above");return}k(!0),i("");try{console.log("🚀 Submitting final project...");const c=v().asFinalSubmission(),q=c.build();console.log("📊 Submission completion:",c.getCompletionPercentage()+"%");const $=await T.submitProject(q);console.log("✅ Project submitted successfully:",$.data),A(!0),setTimeout(()=>{h(`/hackathons/${l}`)},3e3)}catch(s){console.error("❌ Project submission failed:",s);const c=typeof s.response?.data=="string"?s.response.data:"";c.includes("60 seconds")?i("⏱️ Please wait 60 seconds before submitting again."):c.includes("File upload failed")?i("File upload failed. Please try with a smaller file."):c.includes("Team not found")?i("You need to join the hackathon first. Please register for the hackathon."):s.response?.status===500?i("Server error occurred. Please check the backend logs and try again."):i(s.response?.data?.message||s.message||"Failed to submit project. Please try again.")}finally{k(!1)}},Y=()=>x.trim()||b.trim()||j.trim()||u;return d?z?e.jsx(y,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsx(w,{elevation:3,children:e.jsxs(B,{sx:{p:4,textAlign:"center"},children:[e.jsx(W,{sx:{fontSize:60,color:"success.main",mb:2}}),e.jsx(n,{variant:"h4",color:"success.main",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Project Submitted Successfully! 🎉"}),e.jsxs(n,{variant:"h6",sx:{mb:2},children:['Your project "',x,'" has been submitted to the hackathon!']}),e.jsx(n,{variant:"body1",sx:{mb:2},children:"Thank you for participating. Your submission will be evaluated by judges when the judging phase begins."}),e.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Redirecting to hackathon details in 3 seconds..."}),e.jsxs(f,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(p,{variant:"contained",onClick:()=>h(`/hackathons/${l}`),children:"Back to Hackathon"}),e.jsx(p,{variant:"outlined",onClick:()=>h("/submissions"),children:"View All Submissions"})]})]})})}):e.jsxs(y,{maxWidth:"md",sx:{mt:4,mb:6},children:[e.jsxs(f,{sx:{textAlign:"center",mb:4},children:[e.jsx(se,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(n,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"Submit Your Project"}),e.jsx(n,{variant:"h6",color:"textSecondary",children:"Share your amazing creation with the hackathon community!"}),e.jsx(N,{sx:{maxWidth:200,mx:"auto",mt:2}})]}),C&&e.jsx(I,{severity:"error",sx:{mb:3},children:C}),r.length>0&&e.jsxs(I,{severity:"warning",sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1},children:"Please fix the following issues:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:r.map((t,s)=>e.jsx("li",{children:t},s))})]}),e.jsx(w,{elevation:2,children:e.jsx(B,{sx:{p:4},children:e.jsx(f,{component:"form",onSubmit:G,noValidate:!0,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(S,{required:!0,fullWidth:!0,label:"Project Title",value:x,onChange:t=>M(t.target.value),error:r.some(t=>t.includes("Title")),helperText:r.find(t=>t.includes("Title"))||"Give your project a catchy, descriptive name",placeholder:"e.g., AI-Powered Health Assistant",disabled:o})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(S,{required:!0,fullWidth:!0,multiline:!0,rows:6,label:"Project Description",value:b,onChange:t=>U(t.target.value),error:r.some(t=>t.includes("Description")),helperText:r.find(t=>t.includes("Description"))||"Describe what your project does, the problem it solves, and technologies used",placeholder:"Explain your project's purpose, features, technology stack, and impact...",disabled:o})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Project URL (GitHub, Demo, etc.)",value:j,onChange:t=>L(t.target.value),error:r.some(t=>t.includes("URL")),helperText:r.find(t=>t.includes("URL"))||"Optional: Link to your GitHub repo, live demo, or project website",placeholder:"https://github.com/username/project or https://myproject.com",disabled:o,InputProps:{startAdornment:e.jsx(ie,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(O,{fullWidth:!0,error:r.some(t=>t.includes("File")),children:[e.jsx(J,{shrink:!0,htmlFor:"file-upload",children:"Project File Upload *"}),e.jsxs(f,{sx:{mt:2},children:[e.jsx(K,{id:"file-upload",type:"file",onChange:V,disabled:o,inputProps:{accept:".zip,.rar,.tar.gz,.pdf,.doc,.docx,.txt,.md"},sx:{display:"none"}}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(p,{variant:"outlined",component:"span",startIcon:e.jsx(re,{}),disabled:o,sx:{mb:1},children:"Choose File"})}),u&&e.jsxs(n,{variant:"body2",sx:{mt:1,color:"success.main"},children:["✅ Selected: ",u.name," (",(u.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx(Q,{children:r.find(t=>t.includes("File"))||"Upload your project files (source code, documentation, etc.) - Max 50MB"})]})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsxs(X,{direction:"row",spacing:2,justifyContent:"center",sx:{mt:2},children:[e.jsx(p,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:R,disabled:o||P||!Y(),sx:{px:3},children:P?"Saving...":"Save Draft"}),e.jsx(p,{type:"submit",variant:"contained",size:"large",disabled:o,startIcon:o?e.jsx(D,{size:20}):e.jsx(W,{}),sx:{px:6,py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderRadius:3,background:"linear-gradient(45deg, #1976d2 30%, #42a5f5 90%)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(25, 118, 210, 0.3)"},"&:disabled":{background:"grey.400",transform:"none",boxShadow:"none"}},children:o?"Submitting...":"Submit Project"})]}),e.jsx(n,{variant:"caption",color:"textSecondary",sx:{display:"block",textAlign:"center",mt:1},children:"Make sure all required fields are filled before submitting"})]})]})})})})]}):e.jsx(y,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsxs(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(D,{size:40}),e.jsx(n,{variant:"h6",sx:{ml:2},children:"Checking authentication..."})]})})};export{he as default};
