import{r as h,j as e,m as d,n as x,l as A,i as s,y as W,B as o,o as C,C as v,h as c,P as N,G as I,x as B}from"./mui-D_VXG_-A.js";import{j as E,u as R,s as w}from"./index-DyhuwnGA.js";import{T,i as _,b as z,G,j as P,c as F,k as H,F as J,J as U,l as O}from"./mui-icons-C_BHxS9W.js";import{b as $,u as V}from"./router-BvxwVjPs.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const q=({submissionId:l})=>{const[r,S]=h.useState(null),[t,b]=h.useState(!0),[p,m]=h.useState("");h.useEffect(()=>{y()},[l]);const y=async()=>{try{b(!0),m("");const i=await E.getFinalScore(l);S(i.data)}catch(i){console.error("Failed to fetch final score:",i),i.response?.status===500&&i.response?.data?.message?.includes("Submission not found")?m("This submission does not exist in the database yet."):i.response?.status===404?m("No scores available for this submission."):m("Failed to load final score.")}finally{b(!1)}},u=i=>i>=8?"success":i>=6?"warning":"error",k=i=>i>=9?"Outstanding":i>=8?"Excellent":i>=7?"Very Good":i>=6?"Good":i>=5?"Average":"Needs Improvement";return t?e.jsx(d,{elevation:2,children:e.jsxs(x,{sx:{textAlign:"center",py:3},children:[e.jsx(A,{size:30}),e.jsx(s,{variant:"body2",sx:{mt:1},children:"Loading final score..."})]})}):p?e.jsx(W,{severity:"error",children:p}):r===null?e.jsx(d,{elevation:2,children:e.jsx(x,{sx:{textAlign:"center",py:3},children:e.jsx(s,{variant:"body1",color:"textSecondary",children:"No scores available yet"})})}):e.jsx(d,{elevation:2,children:e.jsxs(x,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(T,{sx:{mr:2,color:"primary.main",fontSize:30}}),e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Final Score"})]}),e.jsxs(o,{sx:{textAlign:"center"},children:[e.jsx(s,{variant:"h2",sx:{fontWeight:"bold",mb:1},children:r.toFixed(1)}),e.jsx(s,{variant:"h6",color:"textSecondary",sx:{mb:2},children:"out of 10"}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:e.jsx(C,{label:k(r),color:u(r),variant:"filled",icon:e.jsx(_,{})})})]})]})})},ee=()=>{const{submissionId:l}=$(),r=V(),{user:S}=R(),[t,b]=h.useState(null),[p,m]=h.useState(!0),[y,u]=h.useState("");h.useEffect(()=>{l&&k()},[l]);const k=async()=>{try{m(!0);const n=(await w.getById(parseInt(l))).data;if(n){const j={id:n.id,title:n.title||`Submission ${n.id}`,description:n.description||"No description provided.",teamName:n.team?.name||`Team ${n.team?.id||"Unknown"}`,projectUrl:n.projectUrl,repoUrl:n.repoUrl,technology:n.technology||[],submittedAt:n.submitTime,hackathonId:n.hackathon?.id,hackathonName:n.hackathon?.title||"Unknown Hackathon",filePath:n.filePath};b(j),console.log("📋 Found submission:",j)}else u("Submission not found. It may have been deleted or you may not have permission to view it.")}catch(a){console.error("Failed to fetch submission:",a),a.response?.status===404?u("Submission not found. It may have been deleted or you may not have permission to view it."):u("Failed to load submission details. Please try again.")}finally{m(!1)}},i=()=>{r(`/submissions/${l}/score`)},D=async()=>{if(!(!t||!t.filePath))try{const a=await w.downloadFile(t.id),n=new Blob([a.data]),j=window.URL.createObjectURL(n),f=document.createElement("a");f.href=j;const g=t.filePath.includes("/")?t.filePath.split("/").pop()||"submission_file":t.filePath,L=g.includes("_")?g.substring(g.indexOf("_")+1):g;f.download=L,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(j)}catch(a){console.error("Failed to download file:",a),u("Failed to download file. Please try again.")}};return p?e.jsx(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[e.jsx(A,{size:40}),e.jsx(s,{variant:"h6",sx:{ml:2},children:"Loading submission details..."})]})}):y?e.jsxs(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:[e.jsx(W,{severity:"error",sx:{mb:3},children:y}),e.jsx(c,{variant:"contained",onClick:()=>r("/hackathons"),children:"Back to Hackathons"})]}):t?e.jsxs(v,{maxWidth:"lg",sx:{mt:4,mb:6},children:[e.jsxs(o,{sx:{textAlign:"center",mb:4},children:[e.jsx(z,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(s,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:t.title}),t.teamName&&e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1,mb:2},children:[e.jsx(G,{sx:{color:"text.secondary"}}),e.jsx(s,{variant:"h6",color:"textSecondary",children:t.teamName})]}),t.hackathonName&&e.jsx(C,{label:t.hackathonName,color:"primary",variant:"outlined"})]}),e.jsxs(I,{container:!0,spacing:4,children:[e.jsxs(I,{item:!0,xs:12,md:8,children:[e.jsx(d,{elevation:2,sx:{mb:3},children:e.jsxs(x,{children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Project Description"}),e.jsx(s,{variant:"body1",sx:{lineHeight:1.8},children:t.description})]})}),t.technology&&t.technology.length>0&&e.jsx(d,{elevation:2,sx:{mb:3},children:e.jsxs(x,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(P,{sx:{mr:2,color:"primary.main"}}),e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Technology Stack"})]}),e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.technology.map((a,n)=>e.jsx(C,{label:a,variant:"outlined",size:"small"},n))})]})}),(t.projectUrl||t.repoUrl||t.filePath)&&e.jsx(d,{elevation:2,sx:{mb:3},children:e.jsxs(x,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(F,{sx:{mr:2,color:"primary.main"}}),e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Project Resources"})]}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t.projectUrl&&e.jsx(c,{variant:"outlined",href:t.projectUrl,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(F,{}),sx:{justifyContent:"flex-start"},children:"🔗 Project Link"}),t.repoUrl&&e.jsx(c,{variant:"outlined",href:t.repoUrl,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(P,{}),sx:{justifyContent:"flex-start"},children:"📁 Source Code Repository"}),t.filePath&&e.jsx(c,{variant:"contained",color:"secondary",onClick:D,startIcon:e.jsx(H,{}),sx:{justifyContent:"flex-start"},children:"📎 Download Submitted Files"})]}),t.filePath&&e.jsxs(o,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsxs(s,{variant:"body2",color:"textSecondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{sx:{mr:1,fontSize:16}}),e.jsx("strong",{children:"Submitted File:"})," ",t.filePath.includes("/")?t.filePath.split("/").pop()?.replace(/^\d+_/,"")||"Unknown file":t.filePath.replace(/^\d+_/,"")]}),e.jsx(s,{variant:"caption",color:"textSecondary",sx:{mt:.5,display:"block"},children:`💡 Click "Download Submitted Files" above to access the team's submission files`})]})]})}),S&&e.jsx(d,{elevation:2,children:e.jsxs(x,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(U,{sx:{mr:2,color:"primary.main"}}),e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Judge Actions"})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(c,{variant:"contained",onClick:i,startIcon:e.jsx(U,{}),children:"Submit Score"}),e.jsx(c,{variant:"outlined",startIcon:e.jsx(O,{}),disabled:!0,children:"Add Comments (Coming Soon)"})]})]})})]}),e.jsxs(I,{item:!0,xs:12,md:4,children:[e.jsx(o,{sx:{mb:3},children:e.jsx(q,{submissionId:parseInt(l)})}),e.jsx(d,{elevation:2,children:e.jsxs(x,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Submission Info"}),e.jsx(B,{sx:{mb:2}}),t.submittedAt&&e.jsxs(o,{sx:{mb:2},children:[e.jsx(s,{variant:"body2",color:"textSecondary",children:"Submitted"}),e.jsx(s,{variant:"body1",sx:{fontWeight:"medium"},children:new Date(t.submittedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs(o,{sx:{mb:2},children:[e.jsx(s,{variant:"body2",color:"textSecondary",children:"Submission ID"}),e.jsxs(s,{variant:"body1",sx:{fontWeight:"medium",fontFamily:"monospace"},children:["#",t.id]})]}),t.hackathonId&&e.jsx(o,{children:e.jsx(c,{variant:"text",onClick:()=>r(`/hackathons/${t.hackathonId}`),sx:{p:0,justifyContent:"flex-start"},children:"View Hackathon Details →"})})]})})]})]})]}):e.jsx(v,{maxWidth:"lg",sx:{mt:8,mb:4},children:e.jsxs(N,{elevation:3,sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h5",gutterBottom:!0,children:"Submission Not Found"}),e.jsx(s,{variant:"body1",color:"textSecondary",sx:{mb:3},children:"The submission you're looking for doesn't exist or has been removed."}),e.jsx(c,{variant:"contained",onClick:()=>r("/hackathons"),children:"Back to Hackathons"})]})})};export{ee as default};
