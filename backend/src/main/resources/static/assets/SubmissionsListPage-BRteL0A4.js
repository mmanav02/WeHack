import{r as c,j as t,C as g,B as l,l as F,i as n,y as B,h as x,G as v,m as D,n as H,o as p,a1 as J}from"./mui-D_VXG_-A.js";import{u as U,h as I,s as E,a as G}from"./index-DyhuwnGA.js";import{u as q}from"./router-BvxwVjPs.js";import{g as z,G as L,F as V,c as W,V as T,J as O}from"./mui-icons-C_BHxS9W.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const _=()=>{const d=q(),{user:r}=U(),[j,u]=c.useState([]),[f,k]=c.useState([]),[R,y]=c.useState(!0),[b,w]=c.useState("");c.useEffect(()=>{A()},[r]);const A=async()=>{try{y(!0);try{const h=(await I.getAll()).data;let a=[];for(const o of h)try{const i=await E.getByHackathon(o.id);if(i.data&&i.data.length>0){const m=i.data.map(s=>({id:s.id,title:s.title||`Submission ${s.id}`,description:s.description||"No description available",teamName:s.team?.name||`Team ${s.teamId}`,hackathonId:o.id,hackathonName:o.title||`Hackathon ${o.id}`,submittedAt:s.submitTime||new Date().toISOString(),projectUrl:s.projectUrl,filePath:s.filePath}));a=[...a,...m],console.log(`✅ Found ${m.length} submissions in hackathon ${o.id} (${o.title})`)}}catch{console.log(`No submissions found for hackathon ${o.id}`)}a.length>0?(u(a),console.log(`📋 Total submissions found: ${a.length}`)):u([])}catch(e){console.error("Failed to fetch real submissions:",e),u([])}r&&await P()}catch(e){console.error("Failed to fetch data:",e),w("Failed to load submissions. Please try again.")}finally{y(!1)}},P=async()=>{try{if(!r)return;const h=(await I.getAll()).data,a=[];for(const o of h)try{const s=((await G.getPendingJudgeRequests(o.id)).data||[]).find(S=>S.user?.id===r.id||S.userId===r.id);s&&a.push({hackathonId:o.id,role:"JUDGE",status:s.status})}catch{console.log(`No judge requests found for hackathon ${o.id}`)}console.log("🔍 User roles found:",a),k(a)}catch(e){console.error("Failed to fetch user roles:",e),k([])}},C=e=>!r||!f.length?!1:!!f.find(a=>a.hackathonId===e&&a.role==="JUDGE"&&a.status==="APPROVED"),N=e=>{d(`/submissions/${e}`)},$=e=>{d(`/submissions/${e}/score`)};return R?t.jsx(g,{maxWidth:"lg",sx:{mt:8,mb:4},children:t.jsxs(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[t.jsx(F,{size:40}),t.jsx(n,{variant:"h6",sx:{ml:2},children:"Loading submissions..."})]})}):b?t.jsxs(g,{maxWidth:"lg",sx:{mt:8,mb:4},children:[t.jsx(B,{severity:"error",sx:{mb:3},children:b}),t.jsx(x,{variant:"contained",onClick:()=>d("/hackathons"),children:"Back to Hackathons"})]}):t.jsxs(g,{maxWidth:"lg",sx:{mt:4,mb:6},children:[t.jsxs(l,{sx:{textAlign:"center",mb:4},children:[t.jsx(z,{sx:{fontSize:60,color:"primary.main",mb:2}}),t.jsx(n,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"All Submissions"}),t.jsx(n,{variant:"h6",color:"textSecondary",children:"Browse and judge hackathon submissions"})]}),j.length===0?t.jsxs(l,{sx:{textAlign:"center",py:8},children:[t.jsx(n,{variant:"h5",gutterBottom:!0,children:"No Submissions Found"}),t.jsx(n,{variant:"body1",color:"textSecondary",sx:{mb:3},children:"No projects have been submitted to hackathons yet. Submissions will appear here once participants submit their projects."}),t.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"To submit a project, participants need to use the submission API endpoint after joining a hackathon."}),t.jsx(x,{variant:"contained",onClick:()=>d("/hackathons"),children:"View Hackathons"})]}):t.jsx(v,{container:!0,spacing:3,children:j.map(e=>t.jsx(v,{item:!0,xs:12,md:6,lg:4,children:t.jsxs(D,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:[t.jsxs(H,{sx:{flexGrow:1},children:[t.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:e.title}),e.teamName&&t.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[t.jsx(L,{sx:{fontSize:16,color:"text.secondary"}}),t.jsx(n,{variant:"body2",color:"textSecondary",children:e.teamName})]}),t.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:2,lineHeight:1.6},children:e.description.length>120?`${e.description.substring(0,120)}...`:e.description}),e.hackathonName&&t.jsx(p,{label:e.hackathonName,size:"small",color:"primary",variant:"outlined",sx:{mb:2}}),t.jsxs(l,{sx:{display:"flex",gap:1,mb:1,flexWrap:"wrap"},children:[e.filePath&&t.jsx(p,{icon:t.jsx(V,{}),label:"Files Available",size:"small",color:"secondary",variant:"outlined"}),e.projectUrl&&t.jsx(p,{icon:t.jsx(W,{}),label:"Project Link",size:"small",color:"info",variant:"outlined"})]}),e.submittedAt&&t.jsxs(n,{variant:"caption",color:"textSecondary",children:["Submitted: ",new Date(e.submittedAt).toLocaleDateString()]})]}),t.jsxs(J,{sx:{p:2,pt:0},children:[t.jsx(x,{variant:"outlined",startIcon:t.jsx(T,{}),onClick:()=>N(e.id),sx:{mr:1},children:"View Details"}),C(e.hackathonId||0)&&t.jsx(x,{variant:"contained",startIcon:t.jsx(O,{}),onClick:()=>$(e.id),color:"primary",children:"Judge"})]})]})},e.id))})]})};export{_ as default};
