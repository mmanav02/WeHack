import{r as c,j as t,C as g,B as h,l as P,i as n,y as B,h as u,G as S,m as D,n as H,o as J,a1 as E}from"./mui-D_VXG_-A.js";import{u as F,h as v,s as G,a as q}from"./index-BoPtzRr-.js";import{u as U}from"./router-BvxwVjPs.js";import{b as V,G as T,V as W,J as z}from"./mui-icons-Bo5rYZLF.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const X=()=>{const l=U(),{user:r}=F(),[p,x]=c.useState([]),[f,j]=c.useState([]),[R,b]=c.useState(!0),[k,I]=c.useState("");c.useEffect(()=>{w()},[r]);const w=async()=>{try{b(!0);try{const d=(await v.getAll()).data;let s=[];for(const a of d)try{const i=await G.getByHackathon(a.id);if(i.data&&i.data.length>0){const m=i.data.map(o=>({id:o.id,title:o.title||`Submission ${o.id}`,description:o.description||"No description available",teamName:o.team?.name||`Team ${o.teamId}`,hackathonId:a.id,hackathonName:a.title||`Hackathon ${a.id}`,submittedAt:o.submitTime||new Date().toISOString()}));s=[...s,...m],console.log(`âœ… Found ${m.length} submissions in hackathon ${a.id} (${a.title})`)}}catch{console.log(`No submissions found for hackathon ${a.id}`)}s.length>0?(x(s),console.log(`ðŸ“‹ Total submissions found: ${s.length}`)):x([])}catch(e){console.error("Failed to fetch real submissions:",e),x([])}r&&await A()}catch(e){console.error("Failed to fetch data:",e),I("Failed to load submissions. Please try again.")}finally{b(!1)}},A=async()=>{try{if(!r)return;const d=(await v.getAll()).data,s=[];for(const a of d)try{const o=((await q.getPendingJudgeRequests(a.id)).data||[]).find(y=>y.user?.id===r.id||y.userId===r.id);o&&s.push({hackathonId:a.id,role:"JUDGE",status:o.status})}catch{console.log(`No judge requests found for hackathon ${a.id}`)}console.log("ðŸ” User roles found:",s),j(s)}catch(e){console.error("Failed to fetch user roles:",e),j([])}},C=e=>!r||!f.length?!1:!!f.find(s=>s.hackathonId===e&&s.role==="JUDGE"&&s.status==="APPROVED"),N=e=>{l(`/submissions/${e}`)},$=e=>{l(`/submissions/${e}/score`)};return R?t.jsx(g,{maxWidth:"lg",sx:{mt:8,mb:4},children:t.jsxs(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[t.jsx(P,{size:40}),t.jsx(n,{variant:"h6",sx:{ml:2},children:"Loading submissions..."})]})}):k?t.jsxs(g,{maxWidth:"lg",sx:{mt:8,mb:4},children:[t.jsx(B,{severity:"error",sx:{mb:3},children:k}),t.jsx(u,{variant:"contained",onClick:()=>l("/hackathons"),children:"Back to Hackathons"})]}):t.jsxs(g,{maxWidth:"lg",sx:{mt:4,mb:6},children:[t.jsxs(h,{sx:{textAlign:"center",mb:4},children:[t.jsx(V,{sx:{fontSize:60,color:"primary.main",mb:2}}),t.jsx(n,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:"All Submissions"}),t.jsx(n,{variant:"h6",color:"textSecondary",children:"Browse and judge hackathon submissions"})]}),p.length===0?t.jsxs(h,{sx:{textAlign:"center",py:8},children:[t.jsx(n,{variant:"h5",gutterBottom:!0,children:"No Submissions Found"}),t.jsx(n,{variant:"body1",color:"textSecondary",sx:{mb:3},children:"No projects have been submitted to hackathons yet. Submissions will appear here once participants submit their projects."}),t.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"To submit a project, participants need to use the submission API endpoint after joining a hackathon."}),t.jsx(u,{variant:"contained",onClick:()=>l("/hackathons"),children:"View Hackathons"})]}):t.jsx(S,{container:!0,spacing:3,children:p.map(e=>t.jsx(S,{item:!0,xs:12,md:6,lg:4,children:t.jsxs(D,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:[t.jsxs(H,{sx:{flexGrow:1},children:[t.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:e.title}),e.teamName&&t.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[t.jsx(T,{sx:{fontSize:16,color:"text.secondary"}}),t.jsx(n,{variant:"body2",color:"textSecondary",children:e.teamName})]}),t.jsx(n,{variant:"body2",color:"textSecondary",sx:{mb:2,lineHeight:1.6},children:e.description.length>120?`${e.description.substring(0,120)}...`:e.description}),e.hackathonName&&t.jsx(J,{label:e.hackathonName,size:"small",color:"primary",variant:"outlined",sx:{mb:2}}),e.submittedAt&&t.jsxs(n,{variant:"caption",color:"textSecondary",children:["Submitted: ",new Date(e.submittedAt).toLocaleDateString()]})]}),t.jsxs(E,{sx:{p:2,pt:0},children:[t.jsx(u,{variant:"outlined",startIcon:t.jsx(W,{}),onClick:()=>N(e.id),sx:{mr:1},children:"View Details"}),C(e.hackathonId||0)&&t.jsx(u,{variant:"contained",startIcon:t.jsx(z,{}),onClick:()=>$(e.id),color:"primary",children:"Judge"})]})]})},e.id))})]})};export{X as default};
