import{r as c,j as s,C as f,B as u,l as H,i as o,w as I,h,o as l,m as C,G as J,n as T,a4 as Y}from"./mui-B3kyuV6P.js";import{u as O,h as P,s as E,b as K,a as M}from"./index-B_Yhp6yg.js";import{u as Q}from"./router-Dq9hdC_f.js";import{r as F,J as U,G as X,F as Z,h as _,V as ss}from"./mui-icons-Dh0F4x5g.js";import"./react--cgwBsGs.js";import"./api-xsH4HHeE.js";const cs=()=>{const x=Q(),{user:t}=O(),[m,v]=c.useState(null),[es,R]=c.useState([]),[$,y]=c.useState(!0),[k,z]=c.useState(""),[g,D]=c.useState(!1);c.useEffect(()=>{w()},[t]);const w=async()=>{try{if(y(!0),!t){v(null),y(!1);return}const e=await N(),j=e.some(a=>a.role==="JUDGE"&&a.status==="APPROVED");D(j);let n=[],r;if(j)try{const b=(await P.getAll()).data;for(const i of b)if(e.find(d=>d.hackathonId===i.id&&d.role==="JUDGE"&&d.status==="APPROVED"))try{const V=(await E.getByHackathon(i.id)).data.map(q=>({...q,hackathonName:i.title}));n.push(...V)}catch{console.log(`No submissions found for hackathon ${i.id}`)}r="JUDGE"}catch(a){console.error("Failed to fetch judge submissions:",a)}else try{n=(await E.getByUser(t.id)).data,r="PARTICIPANT"}catch(a){console.error("Failed to fetch user submissions:",a)}const p=K(n,t.id,r);v(p),console.log(`ğŸ“Š Loaded ${p.count} submissions using Factory pattern (Role: ${r})`)}catch(e){console.error("Failed to fetch data:",e),z("Failed to load submissions. Please try again.")}finally{y(!1)}},N=async()=>{try{if(!t)return[];const j=(await P.getAll()).data,n=[];for(const r of j)try{const b=((await M.getPendingJudgeRequests(r.id)).data||[]).find(i=>i.user?.id===t.id||i.userId===t.id);b&&n.push({hackathonId:r.id,role:"JUDGE",status:b.status})}catch{console.log(`No judge requests found for hackathon ${r.id}`)}return console.log("ğŸ” User roles found:",n),R(n),n}catch(e){return console.error("Failed to fetch user roles:",e),R([]),[]}},G=e=>{x(`/submissions/${e}`)},B=e=>{x(`/submissions/${e}/edit`)},W=e=>{x(`/submissions/${e}/judge`)};if($)return s.jsx(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:s.jsxs(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:[s.jsx(H,{size:60}),s.jsx(o,{variant:"h6",sx:{ml:2},children:"Loading submissions using Factory pattern..."})]})});if(!t)return s.jsx(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:s.jsx(I,{severity:"info",sx:{mb:4},children:"Please log in to view your submissions."})});if(k)return s.jsxs(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:[s.jsx(I,{severity:"error",sx:{mb:4},children:k}),s.jsx(h,{variant:"contained",onClick:w,children:"Retry"})]});const S=m?.toArray()||[],A=m?.getUserSubmissions(t.id).toArray()||[],L=m?.getJudgeableSubmissions().toArray()||[];return s.jsxs(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:[s.jsxs(u,{sx:{mb:4},children:[s.jsxs(o,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main"},children:[s.jsx(F,{sx:{fontSize:"inherit",mr:1,verticalAlign:"text-bottom"}}),"Submissions"]}),s.jsxs(u,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[s.jsx(l,{label:`Total: ${m?.count||0}`,color:"primary",variant:"outlined"}),g&&s.jsx(l,{label:`Judgeable: ${L.length}`,color:"secondary",variant:"outlined",icon:s.jsx(U,{})}),s.jsx(l,{label:`Your Submissions: ${A.length}`,color:"success",variant:"outlined"})]}),s.jsx(o,{variant:"h6",color:"textSecondary",children:g?`Viewing all submissions as a judge (${S.length} total)`:`Your submitted projects (${A.length} submissions)`})]}),S.length===0?s.jsxs(C,{elevation:2,sx:{p:4,textAlign:"center"},children:[s.jsx(F,{sx:{fontSize:80,color:"text.secondary",mb:2}}),s.jsx(o,{variant:"h5",gutterBottom:!0,children:"No Submissions Found"}),s.jsx(o,{variant:"body1",color:"textSecondary",sx:{mb:3},children:g?"No submissions available for judging at the moment.":"You haven't submitted any projects yet."}),!g&&s.jsx(h,{variant:"contained",onClick:()=>x("/hackathons"),size:"large",children:"Find Hackathons"})]}):s.jsx(J,{container:!0,spacing:3,children:S.map(e=>s.jsx(J,{item:!0,xs:12,md:6,lg:4,children:s.jsxs(C,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:[s.jsxs(T,{sx:{flexGrow:1},children:[s.jsx(o,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:e.title}),e.teamName&&s.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.jsx(X,{sx:{fontSize:16,color:"text.secondary"}}),s.jsx(o,{variant:"body2",color:"textSecondary",children:e.teamName})]}),s.jsx(o,{variant:"body2",color:"textSecondary",sx:{mb:2,lineHeight:1.6},children:e.description.length>120?`${e.description.substring(0,120)}...`:e.description}),e.hackathonName&&s.jsx(l,{label:e.hackathonName,size:"small",color:"primary",variant:"outlined",sx:{mb:2}}),s.jsxs(u,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.metadata?.hasFile&&s.jsx(l,{icon:s.jsx(Z,{}),label:"File",size:"small",color:"info",variant:"outlined"}),e.metadata?.hasUrl&&s.jsx(l,{icon:s.jsx(_,{}),label:"URL",size:"small",color:"success",variant:"outlined"}),e.isPrimary&&s.jsx(l,{label:"Primary",size:"small",color:"warning",variant:"filled"})]}),e.submittedAt&&s.jsxs(o,{variant:"caption",color:"textSecondary",children:["Submitted: ",new Date(e.submittedAt).toLocaleDateString()]})]}),s.jsxs(Y,{sx:{p:2,pt:0},children:[s.jsx(h,{size:"small",startIcon:s.jsx(ss,{}),onClick:()=>G(e.id),children:"View"}),e.metadata?.canEdit&&s.jsx(h,{size:"small",color:"primary",onClick:()=>B(e.id),children:"Edit"}),e.metadata?.canJudge&&s.jsx(h,{size:"small",color:"secondary",startIcon:s.jsx(U,{}),onClick:()=>W(e.id),children:"Judge"})]})]})},e.id))})]})};export{cs as default};
